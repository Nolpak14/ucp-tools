<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J5JSHV7H1E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-J5JSHV7H1E');
  </script>
  <!-- Ahrefs Analytics -->
  <script src="https://analytics.ahrefs.com/analytics.js" data-key="w/KDij6w81HzA8oXaw60JA" async></script>
  <!-- PostHog Analytics -->
  <script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_KT4EfwHQFwSfY3Aq4gaAH9SZQNVIijRD3xOBzjAPPW5', {
      api_host: 'https://eu.i.posthog.com',
      person_profiles: 'identified_only',
      capture_pageview: true,
      capture_pageleave: true,
      autocapture: true
    });
  </script>
  <!-- jsPDF for PDF report generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universal Commerce Protocol (UCP) Validator & AI Commerce Readiness Checker | UCP.tools</title>
  <meta name="description"
    content="The leading Universal Commerce Protocol (UCP) validator. Check if your e-commerce store is ready for AI shopping agents like Google AI Mode, ChatGPT Shopping, and Microsoft Copilot. Validate UCP profiles, Schema.org markup, and Jan 2026 compliance.">
  <meta name="keywords" content="Universal Commerce Protocol, UCP, AI Commerce, AI Shopping Agents, Google AI Mode, ChatGPT Shopping, Copilot Checkout, Schema.org, E-commerce, UCP Validator, AI Readiness, Google Shopping, Merchant Center">
  <meta name="author" content="UCP.tools">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <link rel="canonical" href="https://ucptools.dev/">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#2E86AB">
  <meta name="google-site-verification" content="Ra49U5gMiADsSr9byqzFnI-GJVA4Gj0_i38nJewkhaU" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ucptools.dev/">
  <meta property="og:title" content="Universal Commerce Protocol (UCP) Validator | AI Commerce Readiness Checker">
  <meta property="og:description"
    content="The leading UCP validator for e-commerce. Check AI shopping agent readiness for Google AI Mode, ChatGPT, and Copilot. Validate UCP profiles and Schema.org compliance.">
  <meta property="og:image" content="https://ucptools.dev/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="UCP.tools">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://ucptools.dev/">
  <meta name="twitter:title" content="Universal Commerce Protocol (UCP) Validator | AI Commerce Readiness">
  <meta name="twitter:description" content="Check if your store is ready for AI shopping agents. Validate UCP profiles for Google AI Mode, ChatGPT Shopping, and Copilot.">
  <meta name="twitter:image" content="https://ucptools.dev/og-image.png">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "https://ucptools.dev/#website",
        "url": "https://ucptools.dev/",
        "name": "UCP.tools",
        "description": "Universal Commerce Protocol (UCP) Validator and AI Commerce Readiness Checker",
        "publisher": {"@id": "https://ucptools.dev/#organization"},
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://ucptools.dev/?domain={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      },
      {
        "@type": "Organization",
        "@id": "https://ucptools.dev/#organization",
        "name": "UCP.tools",
        "url": "https://ucptools.dev/",
        "logo": {
          "@type": "ImageObject",
          "url": "https://ucptools.dev/logo.jpeg",
          "width": 512,
          "height": 512
        },
        "sameAs": []
      },
      {
        "@type": "SoftwareApplication",
        "@id": "https://ucptools.dev/#software",
        "name": "UCP.tools - Universal Commerce Protocol Validator",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Web",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "description": "Free Universal Commerce Protocol (UCP) validator and AI Commerce readiness checker for e-commerce stores. Validates UCP profiles, Schema.org markup, and Google AI Mode compatibility.",
        "featureList": [
          "UCP Profile Validation",
          "Schema.org Markup Validation",
          "AI Shopping Agent Readiness Score",
          "Google AI Mode Compatibility Check",
          "Jan 2026 Compliance Verification",
          "PDF Report Generation",
          "UCP Profile Generator"
        ],
        "screenshot": "https://ucptools.dev/og-image.png",
        "provider": {"@id": "https://ucptools.dev/#organization"}
      },
      {
        "@type": "WebPage",
        "@id": "https://ucptools.dev/#webpage",
        "url": "https://ucptools.dev/",
        "name": "Universal Commerce Protocol (UCP) Validator & AI Commerce Readiness Checker",
        "description": "The leading UCP validator. Check if your e-commerce store is ready for AI shopping agents like Google AI Mode, ChatGPT, and Copilot.",
        "isPartOf": {"@id": "https://ucptools.dev/#website"},
        "about": {"@id": "https://ucptools.dev/#software"},
        "primaryImageOfPage": {
          "@type": "ImageObject",
          "url": "https://ucptools.dev/og-image.png"
        }
      }
    ]
  }
  </script>
  <style>
    /* UCP.tools Brand Design System */
    :root {
      /* Primary Colors (from logo gradient) */
      --brand-blue: #2E86AB;
      --brand-teal: #36B5A2;
      --brand-green: #47C97A;
      --brand-gradient: linear-gradient(135deg, #2E86AB 0%, #36B5A2 50%, #47C97A 100%);
      --brand-gradient-hover: linear-gradient(135deg, #267593 0%, #2EA18F 50%, #3BB86B 100%);

      /* Secondary Colors */
      --color-dark: #1A2B3C;
      --color-medium: #5A6978;
      --color-light: #94A3B8;
      --color-border: #E2E8F0;
      --color-background: #F8FAFC;
      --color-card: #FFFFFF;

      /* Semantic Colors */
      --color-success: #47C97A;
      --color-warning: #F59E0B;
      --color-error: #EF4444;
      --color-info: #2E86AB;

      /* Grade Colors */
      --grade-a-bg: #DCFCE7;
      --grade-a-text: #16A34A;
      --grade-b-bg: #DBEAFE;
      --grade-b-text: #2563EB;
      --grade-c-bg: #FEF9C3;
      --grade-c-text: #CA8A04;
      --grade-d-bg: #FED7AA;
      --grade-d-text: #EA580C;
      --grade-f-bg: #FEE2E2;
      --grade-f-text: #DC2626;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--color-background);
      color: var(--color-dark);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    header {
      background: var(--color-card);
      border-bottom: 1px solid var(--color-border);
      padding: 16px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 24px;
    }

    .header-nav {
      display: flex;
      align-items: center;
      flex: 1;
      justify-content: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      text-decoration: none;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
    }

    .logo-text {
      background: var(--brand-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-suffix {
      font-weight: 400;
      -webkit-text-fill-color: var(--color-medium);
    }

    nav {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    nav>a {
      padding: 8px 12px;
      color: var(--color-medium);
      text-decoration: none;
      transition: color 0.2s;
      border-radius: 6px;
    }

    nav>a:hover {
      color: var(--brand-blue);
      background: rgba(46, 134, 171, 0.08);
    }

    /* Dropdown Menu */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-toggle {
      color: var(--color-medium);
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s;
      background: none;
      border: none;
      font-size: inherit;
      font-family: inherit;
      padding: 8px 12px;
      border-radius: 6px;
    }

    .dropdown-toggle:hover,
    .dropdown:hover .dropdown-toggle {
      color: var(--brand-blue);
      background: rgba(46, 134, 171, 0.08);
    }

    .dropdown-toggle::after {
      content: '‚ñº';
      font-size: 0.6em;
      margin-left: 4px;
      vertical-align: middle;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      min-width: 180px;
      z-index: 1001;
      padding: 8px 0;
      margin-top: 8px;
    }

    .dropdown:hover .dropdown-menu {
      display: block;
    }

    .dropdown-menu a {
      display: block;
      padding: 10px 16px;
      color: var(--color-medium);
      text-decoration: none;
      margin-left: 0;
      transition: background 0.2s, color 0.2s;
    }

    .dropdown-menu a:hover {
      background: rgba(46, 134, 171, 0.08);
      color: var(--brand-blue);
    }

    .dropdown-divider {
      height: 1px;
      background: var(--color-border);
      margin: 8px 0;
    }

    .ph-badge {
      display: flex;
      align-items: center;
      flex-shrink: 0;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }

    .ph-badge:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    .ph-badge img {
      height: 40px;
      width: auto;
    }

    /* Hero */
    .hero {
      text-align: center;
      padding: 60px 20px;
      background: linear-gradient(135deg, rgba(46, 134, 171, 0.1) 0%, rgba(54, 181, 162, 0.05) 50%, rgba(71, 201, 122, 0.1) 100%);
    }

    .hero h1 {
      font-size: 42px;
      margin-bottom: 16px;
      color: var(--color-dark);
    }

    .hero h1 .gradient-text {
      background: var(--brand-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 18px;
      color: var(--color-medium);
      max-width: 600px;
      margin: 0 auto 32px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 40px;
    }

    .tab {
      padding: 12px 24px;
      background: var(--color-card);
      border: 2px solid var(--color-border);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    .tab:hover {
      border-color: var(--brand-blue);
    }

    .tab.active {
      background: var(--brand-gradient);
      color: white;
      border-color: transparent;
    }

    /* Cards */
    .card {
      background: var(--color-card);
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--color-border);
      max-width: 700px;
      margin: 0 auto 40px;
    }

    /* Forms */
    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--color-dark);
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--color-border);
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--brand-blue);
      box-shadow: 0 0 0 3px rgba(46, 134, 171, 0.1);
    }

    /* Buttons */
    .btn {
      display: inline-block;
      padding: 14px 28px;
      background: var(--brand-gradient);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      text-decoration: none;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(46, 134, 171, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: var(--color-card);
      color: var(--color-dark);
      border: 2px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: var(--color-background);
      border-color: var(--brand-blue);
      color: var(--brand-blue);
      box-shadow: none;
      transform: none;
    }

    /* Results */
    .result {
      margin-top: 24px;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }

    .result.show {
      display: block;
    }

    .result.success {
      background: #dcfce7;
      border: 1px solid #86efac;
    }

    .result.error {
      background: #fee2e2;
      border: 1px solid #fca5a5;
    }

    /* Score Badges */
    .score-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 24px;
    }

    .score-badge.A {
      background: var(--grade-a-bg);
      color: var(--grade-a-text);
    }

    .score-badge.B {
      background: var(--grade-b-bg);
      color: var(--grade-b-text);
    }

    .score-badge.C {
      background: var(--grade-c-bg);
      color: var(--grade-c-text);
    }

    .score-badge.D {
      background: var(--grade-d-bg);
      color: var(--grade-d-text);
    }

    .score-badge.F {
      background: var(--grade-f-bg);
      color: var(--grade-f-text);
    }

    /* Issues */
    .issues-list {
      margin-top: 16px;
    }

    .issue {
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 6px;
      font-size: 14px;
    }

    .issue.error {
      background: #fef2f2;
      border-left: 3px solid var(--color-error);
    }

    .issue.warn {
      background: #fefce8;
      border-left: 3px solid var(--color-warning);
    }

    .issue.info {
      background: rgba(46, 134, 171, 0.1);
      border-left: 3px solid var(--color-info);
    }

    .issue code {
      background: rgba(0, 0, 0, 0.05);
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Fix Cards - Expandable Action Items */
    .fix-card {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 10px;
      margin-bottom: 12px;
      overflow: hidden;
      transition: box-shadow 0.2s, border-color 0.2s;
    }

    .fix-card:hover {
      border-color: var(--brand-blue);
      box-shadow: 0 2px 8px rgba(46, 134, 171, 0.1);
    }

    .fix-card.critical { border-left: 4px solid var(--color-error); }
    .fix-card.warning { border-left: 4px solid var(--color-warning); }
    .fix-card.info { border-left: 4px solid var(--color-info); }

    .fix-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      cursor: pointer;
      user-select: none;
    }

    .fix-card-priority {
      flex-shrink: 0;
    }

    .fix-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--color-background);
      color: var(--color-dark);
      font-weight: 700;
      font-size: 13px;
    }

    .fix-card.critical .fix-number { background: #fef2f2; color: #DC2626; }
    .fix-card.warning .fix-number { background: #fefce8; color: #CA8A04; }
    .fix-card.info .fix-number { background: #f0f9ff; color: #0369a1; }

    .fix-card-content {
      flex: 1;
      min-width: 0;
    }

    .fix-card-title {
      font-weight: 600;
      font-size: 14px;
      color: var(--color-dark);
      margin-bottom: 4px;
    }

    .fix-card-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .fix-severity-tag {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      padding: 2px 8px;
      border-radius: 4px;
    }

    .fix-severity-tag.critical { background: #fef2f2; color: #DC2626; }
    .fix-severity-tag.warning { background: #fefce8; color: #CA8A04; }
    .fix-severity-tag.info { background: #f0f9ff; color: #0369a1; }

    .fix-code-tag {
      font-size: 10px;
      font-family: monospace;
      padding: 2px 8px;
      background: var(--color-background);
      color: var(--color-medium);
      border-radius: 4px;
    }

    .fix-card-chevron {
      flex-shrink: 0;
      font-size: 14px;
      color: var(--color-medium);
      transition: transform 0.2s;
    }

    .fix-card.expanded .fix-card-chevron {
      transform: rotate(180deg);
    }

    .fix-card-body {
      display: none;
      padding: 0 16px 16px;
      border-top: 1px solid var(--color-border);
      background: var(--color-background);
    }

    .fix-card.expanded .fix-card-body {
      display: block;
    }

    .fix-card-impact {
      padding: 12px 0;
      font-size: 13px;
      color: var(--color-medium);
      font-style: italic;
    }

    .fix-card-instruction {
      font-size: 14px;
      color: var(--color-dark);
      line-height: 1.6;
      padding: 12px;
      background: var(--color-card);
      border-radius: 8px;
      border: 1px solid var(--color-border);
    }

    .fix-code-block {
      margin-top: 12px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #334155;
    }

    .fix-code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: #334155;
      font-size: 12px;
      color: #94a3b8;
    }

    .fix-copy-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #94a3b8;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .fix-copy-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    .fix-copy-btn.copied {
      background: #16a34a;
      color: #fff;
    }

    .fix-code-block pre {
      margin: 0;
      padding: 12px;
      background: #1e293b;
      font-size: 12px;
      line-height: 1.5;
      overflow-x: auto;
    }

    .fix-code-block code {
      color: #e2e8f0;
      font-family: 'Fira Code', 'Consolas', monospace;
    }

    .fix-card-links {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .fix-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: var(--brand-blue);
      text-decoration: none;
      padding: 6px 12px;
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 6px;
      transition: all 0.2s;
    }

    .fix-link:hover {
      background: rgba(46, 134, 171, 0.1);
      border-color: var(--brand-blue);
    }

    /* Enhanced Results UI */
    .result-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--color-border);
    }

    .result-grade-circle {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 42px;
      font-weight: 800;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .result-grade-circle.grade-A { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; }
    .result-grade-circle.grade-B { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
    .result-grade-circle.grade-C { background: linear-gradient(135deg, #eab308, #ca8a04); color: white; }
    .result-grade-circle.grade-D { background: linear-gradient(135deg, #f97316, #ea580c); color: white; }
    .result-grade-circle.grade-F { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }

    .result-score-info {
      flex: 1;
    }

    .result-score-info h3 {
      font-size: 28px;
      margin-bottom: 4px;
      color: var(--color-dark);
    }

    .result-score-info .score-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--color-medium);
    }

    .result-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .result-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .result-badge.success { background: #dcfce7; color: #16a34a; }
    .result-badge.warning { background: #fef9c3; color: #ca8a04; }
    .result-badge.error { background: #fee2e2; color: #dc2626; }
    .result-badge.info { background: #dbeafe; color: #2563eb; }

    .result-section {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      transition: box-shadow 0.2s;
    }

    .result-section:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .result-section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .result-section-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }

    .result-section-icon.ucp { background: rgba(46, 134, 171, 0.15); }
    .result-section-icon.schema { background: rgba(71, 201, 122, 0.15); }
    .result-section-icon.product { background: rgba(245, 158, 11, 0.15); }
    .result-section-icon.shipping { background: rgba(59, 130, 246, 0.15); }
    .result-section-icon.compliance { background: rgba(139, 92, 246, 0.15); }

    .result-section-title {
      flex: 1;
    }

    .result-section-title h4 {
      margin: 0;
      font-size: 16px;
      color: var(--color-dark);
    }

    .result-section-title p {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--color-medium);
    }

    .result-section-status {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
    }

    .result-section-status.pass { background: #dcfce7; color: #16a34a; }
    .result-section-status.warn { background: #fef9c3; color: #ca8a04; }
    .result-section-status.fail { background: #fee2e2; color: #dc2626; }

    .result-stats-row {
      display: flex;
      gap: 24px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--color-border);
    }

    .result-stat {
      text-align: center;
    }

    .result-stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--color-dark);
    }

    .result-stat-label {
      font-size: 12px;
      color: var(--color-medium);
    }

    .benchmark-card {
      background: linear-gradient(135deg, rgba(99,102,241,0.08), rgba(168,85,247,0.08));
      border: 1px solid rgba(99,102,241,0.2);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .benchmark-card h4 {
      margin: 0 0 12px;
      font-size: 14px;
      color: var(--color-medium);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .benchmark-main {
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
    }

    .benchmark-percentile {
      font-size: 36px;
      font-weight: 800;
      color: #6366f1;
    }

    .benchmark-label {
      font-size: 14px;
      color: var(--color-medium);
    }

    .benchmark-details {
      font-size: 13px;
      color: var(--color-medium);
    }

    .action-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }

    .action-card {
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      border: 1px solid var(--color-border);
    }

    .action-card.badge-card {
      background: linear-gradient(135deg, rgba(46,134,171,0.08), rgba(71,201,122,0.08));
      border-color: rgba(46,134,171,0.2);
    }

    .action-card.report-card {
      background: linear-gradient(135deg, rgba(139,92,246,0.08), rgba(236,72,153,0.08));
      border-color: rgba(139,92,246,0.2);
    }

    .action-card h4 {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 16px;
    }

    .action-card p {
      font-size: 13px;
      color: var(--color-medium);
      margin-bottom: 16px;
    }

    /* Code Block */
    pre {
      background: var(--color-dark);
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.5;
      text-align: left;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Pricing Section */
    .pricing {
      padding: 60px 20px;
      background: var(--color-card);
    }

    .pricing h2 {
      text-align: center;
      margin-bottom: 40px;
      color: var(--color-dark);
    }

    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      max-width: 900px;
      margin: 0 auto;
    }

    .pricing-card {
      border: 2px solid var(--color-border);
      border-radius: 12px;
      padding: 32px;
      text-align: center;
      background: var(--color-card);
    }

    .pricing-card.featured {
      border-color: var(--brand-blue);
      position: relative;
    }

    .pricing-card.featured::before {
      content: 'Most Popular';
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--brand-gradient);
      color: white;
      padding: 4px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .pricing-card h3 {
      margin-bottom: 8px;
      color: var(--color-dark);
    }

    .price {
      font-size: 48px;
      font-weight: 700;
      background: var(--brand-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .price span {
      font-size: 16px;
      -webkit-text-fill-color: var(--color-medium);
      font-weight: 400;
    }

    .pricing-card ul {
      list-style: none;
      margin: 24px 0;
      text-align: left;
    }

    .pricing-card li {
      padding: 8px 0;
      border-bottom: 1px solid var(--color-border);
      color: var(--color-dark);
    }

    .pricing-card li::before {
      content: '\2713';
      color: var(--color-success);
      margin-right: 8px;
      font-weight: bold;
    }

    /* Footer */
    footer {
      padding: 40px 20px;
      text-align: center;
      color: var(--color-medium);
      border-top: 1px solid var(--color-border);
      background: var(--color-card);
    }

    footer a {
      color: var(--brand-blue);
      text-decoration: none;
    }

    footer a:hover {
      color: var(--brand-teal);
    }

    /* Utilities */
    .hidden {
      display: none !important;
    }

    .text-muted {
      color: var(--color-medium);
    }

    .link-brand {
      color: var(--brand-blue);
      text-decoration: none;
    }

    .link-brand:hover {
      color: var(--brand-teal);
    }

    /* Responsive */
    @media (max-width: 900px) {
      .header-inner {
        flex-wrap: wrap;
      }

      .header-nav {
        order: 3;
        width: 100%;
        margin-top: 12px;
      }

      .ph-badge {
        order: 2;
      }
    }

    @media (max-width: 600px) {
      .hero h1 {
        font-size: 28px;
      }

      .tabs {
        flex-direction: column;
      }

      .header-inner {
        flex-direction: column;
        gap: 16px;
      }

      .header-nav {
        order: 2;
        margin-top: 0;
      }

      .ph-badge {
        order: 3;
      }

      nav {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 4px;
      }

      nav>a,
      .dropdown-toggle {
        padding: 6px 10px;
        font-size: 14px;
      }
    }

    /* ========================================
       NEW REPORT UI - Complete Rebuild
       ======================================== */

    /* Report Header - Executive Summary */
    .report-header {
      display: flex;
      align-items: center;
      gap: 24px;
      padding: 28px;
      background: var(--color-card);
      border-radius: 16px;
      border: 1px solid var(--color-border);
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    .report-grade {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      font-weight: 800;
      color: white;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .report-grade.grade-A { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .report-grade.grade-B { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    .report-grade.grade-C { background: linear-gradient(135deg, #eab308, #ca8a04); }
    .report-grade.grade-D { background: linear-gradient(135deg, #f97316, #ea580c); }
    .report-grade.grade-F { background: linear-gradient(135deg, #ef4444, #dc2626); }

    .report-score-info {
      flex: 1;
    }

    .report-score {
      font-size: 42px;
      font-weight: 800;
      color: var(--color-dark);
      line-height: 1;
    }

    .report-score span {
      font-size: 18px;
      font-weight: 500;
      color: var(--color-medium);
    }

    .report-label {
      font-size: 16px;
      font-weight: 600;
      margin-top: 4px;
    }

    .report-benchmark {
      text-align: right;
      padding: 16px 20px;
      background: linear-gradient(135deg, rgba(99,102,241,0.08), rgba(168,85,247,0.08));
      border-radius: 12px;
      border: 1px solid rgba(99,102,241,0.15);
    }

    .report-benchmark-value {
      font-size: 28px;
      font-weight: 800;
      color: #6366f1;
    }

    .report-benchmark-label {
      font-size: 12px;
      color: var(--color-medium);
    }

    /* Quick Stats Row */
    .report-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .report-stat {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--color-card);
      border-radius: 12px;
      border: 1px solid var(--color-border);
      transition: all 0.2s;
    }

    .report-stat:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .report-stat.pass { border-left: 4px solid #22c55e; }
    .report-stat.warn { border-left: 4px solid #eab308; }
    .report-stat.fail { border-left: 4px solid #ef4444; }

    .report-stat-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .report-stat.pass .report-stat-icon { background: #dcfce7; color: #16a34a; }
    .report-stat.warn .report-stat-icon { background: #fef9c3; color: #ca8a04; }
    .report-stat.fail .report-stat-icon { background: #fee2e2; color: #dc2626; }

    .report-stat-text {
      font-size: 14px;
      font-weight: 600;
      color: var(--color-dark);
    }

    /* Collapsible Report Sections */
    .report-section {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 12px;
      margin-bottom: 12px;
      overflow: hidden;
      transition: box-shadow 0.2s;
    }

    .report-section:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .report-section-header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 20px;
      cursor: pointer;
      user-select: none;
      transition: background 0.2s;
    }

    .report-section-header:hover {
      background: var(--color-background);
    }

    .report-section-status {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .report-section-status.pass { background: #dcfce7; color: #16a34a; }
    .report-section-status.warn { background: #fef9c3; color: #ca8a04; }
    .report-section-status.fail { background: #fee2e2; color: #dc2626; }

    .report-section-title {
      flex: 1;
      min-width: 0;
    }

    .report-section-title strong {
      display: block;
      font-size: 15px;
      color: var(--color-dark);
    }

    .report-section-title span {
      font-size: 13px;
      color: var(--color-medium);
    }

    .report-section-toggle {
      font-size: 12px;
      color: var(--color-light);
      transition: transform 0.2s;
    }

    .report-section.collapsed .report-section-toggle {
      transform: rotate(-90deg);
    }

    .report-section-body {
      padding: 0 20px 20px;
      border-top: 1px solid var(--color-border);
      background: var(--color-background);
    }

    .report-section.collapsed .report-section-body {
      display: none;
    }

    .report-schema-stats {
      display: flex;
      gap: 24px;
      padding: 16px 0;
      margin-bottom: 12px;
      border-bottom: 1px solid var(--color-border);
      font-size: 14px;
      color: var(--color-medium);
    }

    .report-schema-stats strong {
      color: var(--color-dark);
      font-weight: 700;
    }

    .report-empty-state {
      text-align: center;
      padding: 32px 20px;
    }

    .report-empty-state p {
      margin-bottom: 16px;
      color: var(--color-medium);
    }

    /* Issue Items */
    .issue-item {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 10px;
      margin-top: 12px;
      overflow: hidden;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .issue-item:hover {
      border-color: var(--brand-blue);
    }

    .issue-item-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 14px 16px;
      cursor: pointer;
      flex-wrap: wrap;
    }

    .issue-severity-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .issue-severity-dot.error { background: #ef4444; }
    .issue-severity-dot.warn { background: #eab308; }
    .issue-severity-dot.info { background: #3b82f6; }

    .issue-code {
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 11px;
      padding: 3px 8px;
      background: var(--color-background);
      color: var(--color-medium);
      border-radius: 4px;
      flex-shrink: 0;
    }

    .issue-message {
      flex: 1;
      font-size: 14px;
      color: var(--color-dark);
      min-width: 0;
    }

    .issue-has-fix {
      font-size: 12px;
      color: var(--brand-blue);
      font-weight: 600;
      flex-shrink: 0;
    }

    .issue-context {
      padding: 4px 16px 8px;
      font-size: 12px;
      color: var(--brand-blue);
      font-weight: 600;
    }

    .issue-hint {
      padding: 0 16px 14px;
      font-size: 13px;
      color: var(--color-medium);
      font-style: italic;
    }

    .report-ucp-summary {
      padding: 16px;
      margin-bottom: 12px;
      background: rgba(46, 134, 171, 0.08);
      border-radius: 8px;
      border-left: 4px solid var(--brand-blue);
    }

    .report-ucp-summary p {
      margin: 0;
      font-size: 14px;
      color: var(--color-dark);
    }

    /* Issue Fix Panel (Inline Expandable) */
    .issue-fix-panel {
      display: none;
      padding: 16px;
      background: linear-gradient(to bottom, rgba(46,134,171,0.04), rgba(46,134,171,0.08));
      border-top: 1px solid var(--color-border);
    }

    .issue-item.expanded .issue-fix-panel {
      display: block;
    }

    .issue-fix-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--color-dark);
      margin-bottom: 8px;
    }

    .issue-fix-description {
      font-size: 14px;
      color: var(--color-dark);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .issue-fix-code {
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #334155;
      margin-bottom: 12px;
    }

    .issue-fix-code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: #334155;
      font-size: 12px;
      color: #94a3b8;
    }

    .issue-copy-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #94a3b8;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .issue-copy-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    .issue-copy-btn.copied {
      background: #16a34a;
      color: #fff;
    }

    .issue-fix-code pre {
      margin: 0;
      padding: 12px;
      background: #1e293b;
      font-size: 12px;
      line-height: 1.5;
      overflow-x: auto;
    }

    .issue-fix-code code {
      color: #e2e8f0;
      font-family: 'Fira Code', 'Consolas', monospace;
    }

    .issue-fix-links {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .issue-fix-links a {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: var(--brand-blue);
      text-decoration: none;
      padding: 6px 12px;
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: 6px;
      transition: all 0.2s;
    }

    .issue-fix-links a:hover {
      background: rgba(46, 134, 171, 0.1);
      border-color: var(--brand-blue);
    }

    /* Report Actions */
    .report-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      padding: 24px;
      background: var(--color-card);
      border-radius: 12px;
      border: 1px solid var(--color-border);
      margin-top: 20px;
    }

    /* Responsive for Report UI */
    @media (max-width: 768px) {
      .report-header {
        flex-direction: column;
        text-align: center;
        gap: 16px;
      }

      .report-benchmark {
        text-align: center;
      }

      .report-stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .report-actions {
        justify-content: center;
      }

      .issue-item-header {
        flex-wrap: wrap;
      }

      .issue-message {
        width: 100%;
        order: 3;
        margin-top: 8px;
      }
    }

    @media (max-width: 480px) {
      .report-stats {
        grid-template-columns: 1fr;
      }

      .report-actions {
        flex-direction: column;
      }

      .report-actions .btn {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="container header-inner">
      <a href="/" class="logo">
        <img src="/logo.jpeg" alt="UCP.tools logo" class="logo-icon">
        <span class="logo-text">UCP<span class="logo-suffix">.tools</span></span>
      </a>
      <div class="header-nav">
        <nav>
          <div class="dropdown">
            <span class="dropdown-toggle">Tools</span>
            <div class="dropdown-menu">
              <a href="#validate" onclick="switchTab('validate'); closeDropdowns(); return false;">üîç Validator</a>
              <a href="#simulate" onclick="switchTab('simulate'); closeDropdowns(); return false;">ü§ñ AI Simulator</a>
              <a href="#generate" onclick="switchTab('generate'); closeDropdowns(); return false;">üìù Generator</a>
              <a href="#schema" onclick="switchTab('schema'); closeDropdowns(); return false;">üìä Schema Builder</a>
            </div>
          </div>
          <a href="/learn">Learn</a>
          <div class="dropdown">
            <span class="dropdown-toggle">Guides</span>
            <div class="dropdown-menu">
              <a href="/guides/fastucp">‚ö° FastUCP</a>
              <div class="dropdown-divider"></div>
              <a href="/guides/shopify">üõí Shopify</a>
              <a href="/guides/woocommerce">üîå WooCommerce</a>
              <a href="/guides/magento">üß± Magento</a>
              <a href="/guides/wix">‚ú® Wix</a>
              <a href="/guides/bigcommerce">üì¶ BigCommerce</a>
              <a href="/guides/squarespace">‚óºÔ∏è Squarespace</a>
            </div>
          </div>
          <a href="/directory">Directory</a>
          <a href="https://ucp.dev/specification/overview/" target="_blank">Docs ‚Üó</a>
        </nav>
      </div>
      <a href="https://www.producthunt.com/products/ucp-tools?embed=true&amp;utm_source=badge-featured&amp;utm_medium=badge&amp;utm_campaign=badge-ucp-tools"
        target="_blank" rel="noopener noreferrer" class="ph-badge">
        <img
          src="https://api.producthunt.com/widgets/embed-image/v1/featured.svg?post_id=1063017&amp;theme=light&amp;t=1768475714634"
          alt="Featured on Product Hunt" />
      </a>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <h1>AI Commerce <span class="gradient-text">Readiness</span></h1>
      <p>Check if your store is ready for ChatGPT, Google AI Mode, and Copilot checkout. Validates UCP profile +
        Schema.org requirements.</p>

      <div class="tabs">
        <button class="tab active" data-tab="validate">Check Readiness</button>
        <button class="tab" data-tab="simulate">ü§ñ AI Agent Test</button>
        <button class="tab" data-tab="security">üîí Security Scan</button>
        <button class="tab" data-tab="feed">üì¶ Feed Analyzer</button>
        <button class="tab" data-tab="compliance">üìã GDPR Generator</button>
        <button class="tab" data-tab="generate">Generate UCP</button>
        <button class="tab" data-tab="schema">Schema Snippets</button>
      </div>

      <!-- Validate Tab -->
      <div class="card" id="validate-panel">
        <h3 style="margin-bottom: 20px;">Check AI Commerce Readiness</h3>
        <form id="validate-form">
          <div class="form-group">
            <label for="domain">Your Domain</label>
            <input type="text" id="domain" placeholder="yourstore.com" required>
            <small class="text-muted">We'll check UCP profile + Schema.org (MerchantReturnPolicy,
              shippingDetails)</small>
          </div>
          <button type="submit" class="btn" id="validate-btn">Check AI Readiness</button>
        </form>

        <div class="result" id="validate-result"></div>
      </div>

      <!-- Generate Tab -->
      <div class="card hidden" id="generate-panel">
        <h3 style="margin-bottom: 20px;">Generate UCP Profile</h3>
        <form id="generate-form">
          <div class="form-group">
            <label for="gen-domain">Your Domain</label>
            <input type="text" id="gen-domain" placeholder="yourstore.com" required>
          </div>
          <div class="form-group">
            <label for="gen-endpoint">REST API Endpoint</label>
            <input type="url" id="gen-endpoint" placeholder="https://api.yourstore.com/ucp/v1" required>
          </div>
          <div class="form-group">
            <label>Capabilities</label>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="cap-checkout" checked disabled> Checkout (required)
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="cap-order"> Order
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="cap-fulfillment"> Fulfillment
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="cap-discount"> Discount
              </label>
            </div>
          </div>
          <button type="submit" class="btn" id="generate-btn">Generate Profile</button>
        </form>

        <div class="result" id="generate-result"></div>
      </div>

      <!-- Schema Snippets Tab -->
      <div class="card hidden" id="schema-panel">
        <h3 style="margin-bottom: 20px;">Generate Schema.org Snippets</h3>
        <p style="margin-bottom: 24px; color: var(--color-medium);">
          Generate ready-to-use JSON-LD snippets for AI Commerce requirements (Jan 2026).
        </p>

        <div class="form-group">
          <label>Return Policy Template</label>
          <select id="return-template">
            <option value="30-day-free">30-Day Free Returns (Recommended)</option>
            <option value="14-day-free">14-Day Free Returns</option>
            <option value="30-day-paid">30-Day Returns (Customer Pays Shipping)</option>
            <option value="no-returns">No Returns / Final Sale</option>
            <option value="custom">Custom...</option>
          </select>
        </div>

        <div id="custom-return" class="hidden"
          style="background: var(--color-background); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px;">Return Window (days)</label>
              <input type="number" id="return-days" value="30" min="0" max="365">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px;">Country Code</label>
              <input type="text" id="return-country" value="US" maxlength="2">
            </div>
          </div>
          <div class="form-group" style="margin-top: 12px; margin-bottom: 0;">
            <label style="display: flex; align-items: center; gap: 8px; font-weight: normal; font-size: 13px;">
              <input type="checkbox" id="free-returns" checked> Free returns (merchant pays shipping)
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>Shipping Template</label>
          <select id="shipping-template">
            <option value="us-standard">US Standard ($5.99, 3-7 days)</option>
            <option value="us-free">US Free Shipping (5-10 days)</option>
            <option value="us-express">US Express ($14.99, 1-2 days)</option>
            <option value="international">International ($19.99, 7-21 days)</option>
            <option value="custom">Custom...</option>
          </select>
        </div>

        <div id="custom-shipping" class="hidden"
          style="background: var(--color-background); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px;">Rate</label>
              <input type="number" id="shipping-rate" value="5.99" step="0.01" min="0">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px;">Currency</label>
              <input type="text" id="shipping-currency" value="USD" maxlength="3">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px;">Country</label>
              <input type="text" id="shipping-country" value="US" maxlength="2">
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px;">Transit Time (min-max days)</label>
              <div style="display: flex; gap: 8px;">
                <input type="number" id="transit-min" value="3" min="0" style="width: 50%;">
                <input type="number" id="transit-max" value="7" min="0" style="width: 50%;">
              </div>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px;">Handling Time (min-max days)</label>
              <div style="display: flex; gap: 8px;">
                <input type="number" id="handling-min" value="1" min="0" style="width: 50%;">
                <input type="number" id="handling-max" value="2" min="0" style="width: 50%;">
              </div>
            </div>
          </div>
        </div>

        <button class="btn" id="generate-schema-btn" onclick="generateSchema()">Generate Snippets</button>

        <div class="result" id="schema-result"></div>
      </div>

      <!-- AI Agent Simulation Tab -->
      <div class="card hidden" id="simulate-panel">
        <h3 style="margin-bottom: 8px;">ü§ñ AI Agent Simulation Test</h3>
        <p style="margin-bottom: 20px; color: var(--color-medium); font-size: 14px;">
          Test how AI shopping agents (ChatGPT, Google AI, Copilot) would actually interact with your UCP
          implementation.
          Goes beyond spec compliance to prove real-world functionality.
        </p>
        <form id="simulate-form">
          <div class="form-group">
            <label for="simulate-domain">Your Domain</label>
            <input type="text" id="simulate-domain" placeholder="yourstore.com" required>
            <small class="text-muted">We'll simulate an AI agent discovering and interacting with your UCP
              profile</small>
          </div>
          <button type="submit" class="btn" id="simulate-btn">üöÄ Run AI Agent Simulation</button>
        </form>

        <div class="result" id="simulate-result"></div>
      </div>

      <!-- Security Scanner Tab -->
      <div class="card hidden" id="security-panel">
        <h3 style="margin-bottom: 8px;">üîí Security Posture Scanner</h3>
        <p style="margin-bottom: 20px; color: var(--color-medium); font-size: 14px;">
          Scan your UCP endpoint for common security misconfigurations. Exposing REST endpoints for AI agents
          creates new attack surfaces - make sure you're protected.
        </p>
        <form id="security-form">
          <div class="form-group">
            <label for="security-domain">Your Domain</label>
            <input type="text" id="security-domain" placeholder="yourstore.com" required>
            <small class="text-muted">We'll check HTTPS, security headers, rate limiting, CORS, and more</small>
          </div>
          <button type="submit" class="btn" id="security-btn">üîç Run Security Scan</button>
        </form>

        <div class="result" id="security-result"></div>
      </div>

      <!-- Feed Analyzer Tab -->
      <div class="card hidden" id="feed-panel">
        <h3 style="margin-bottom: 8px;">üì¶ Product Feed Quality Analyzer</h3>
        <p style="margin-bottom: 20px; color: var(--color-medium); font-size: 14px;">
          Deep analysis of your product data quality for AI agent visibility.
          AI shopping agents evaluate product feed completeness, identifiers, images, and pricing to decide what to recommend.
        </p>

        <form id="feed-form">
          <div class="form-group">
            <label for="feed-url">Product Page or Catalog URL</label>
            <input type="url" id="feed-url" placeholder="https://yourstore.com/products" required>
            <small class="text-muted">We'll scan for Schema.org Product markup and analyze data quality</small>
          </div>

          <div class="form-group">
            <label for="feed-max-products">Max Products to Analyze</label>
            <select id="feed-max-products">
              <option value="10">10 products (quick scan)</option>
              <option value="25">25 products</option>
              <option value="50" selected>50 products (recommended)</option>
              <option value="100">100 products (thorough)</option>
            </select>
          </div>

          <button type="submit" class="btn" id="feed-btn">üîç Analyze Product Feed</button>
        </form>

        <div class="result" id="feed-result"></div>
      </div>

      <!-- GDPR Compliance Generator Tab -->
      <div class="card hidden" id="compliance-panel">
        <h3 style="margin-bottom: 8px;">üìã GDPR/Privacy Compliance Generator</h3>
        <p style="margin-bottom: 20px; color: var(--color-medium); font-size: 14px;">
          Generate privacy policy addendums and consent language for AI-powered shopping.
          When purchases happen via AI agents, traditional cookie consent doesn't apply - you need specific disclosures.
        </p>

        <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 13px;">
          <strong>‚ö†Ô∏è Disclaimer:</strong> This generates templates for informational purposes only and does NOT constitute legal advice.
          Please have a qualified legal professional review before use.
        </div>

        <form id="compliance-form">
          <div class="form-group">
            <label for="compliance-company">Company Name *</label>
            <input type="text" id="compliance-company" placeholder="Your Company Name" required>
          </div>

          <div class="form-group">
            <label for="compliance-email">Privacy Contact Email</label>
            <input type="email" id="compliance-email" placeholder="privacy@yourcompany.com">
          </div>

          <div class="form-group">
            <label for="compliance-dpo">Data Protection Officer Email (optional)</label>
            <input type="email" id="compliance-dpo" placeholder="dpo@yourcompany.com">
          </div>

          <div class="form-group">
            <label>Compliance Regions *</label>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="region-eu" checked> EU (GDPR)
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="region-uk"> UK (UK GDPR)
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="region-california"> California (CCPA/CPRA)
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="region-global"> Global
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>AI Platforms You're Using *</label>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="platform-openai" checked> ChatGPT (OpenAI)
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="platform-google" checked> Google AI Mode
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="platform-microsoft"> Microsoft Copilot
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="compliance-basis">Lawful Basis for Processing *</label>
            <select id="compliance-basis" required>
              <option value="contract" selected>Contract Performance (Recommended for orders)</option>
              <option value="consent">Explicit Consent</option>
              <option value="legitimate">Legitimate Interests</option>
              <option value="legal">Legal Obligation</option>
            </select>
            <small class="text-muted" id="basis-description">Processing is necessary to fulfill customer orders</small>
          </div>

          <div class="form-group">
            <label>Optional Sections</label>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="include-marketing"> Marketing consent language
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                <input type="checkbox" id="include-retention"> Data retention policy
              </label>
            </div>
          </div>

          <button type="submit" class="btn" id="compliance-btn">üìÑ Generate Compliance Documents</button>
        </form>

        <div class="result" id="compliance-result"></div>
      </div>
    </div>
  </section>

  <section class="pricing" id="pricing">
    <div class="container">
      <h2>Free & Open</h2>
      <div class="pricing-grid" style="max-width: 650px;">
        <div class="pricing-card">
          <h3>Free</h3>
          <div class="price">$0</div>
          <ul>
            <li>Unlimited validations</li>
            <li>Profile generation</li>
            <li>Download JSON file</li>
            <li>A-F grading & recommendations</li>
          </ul>
          <a href="#validate" class="btn btn-secondary">Start Validating</a>
        </div>
        <div class="pricing-card" style="border-color: var(--brand-teal);">
          <h3>Support the Project</h3>
          <div class="price" style="font-size: 36px;">&#9829;</div>
          <ul>
            <li>Help keep this tool free</li>
            <li>Support independent development</li>
            <li>Get a warm fuzzy feeling</li>
            <li>Karma points (unverified)</li>
          </ul>
          <a href="https://buymeacoffee.com/ucptools" target="_blank" class="btn">Buy Me a Coffee</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Opt-out Info Section -->
  <section id="optout"
    style="padding: 40px 20px; background: var(--color-background); border-top: 1px solid var(--color-border);">
    <div class="container" style="max-width: 800px;">
      <h2 style="margin-bottom: 20px; text-align: center;">How to Opt Out of AI Commerce</h2>
      <div
        style="background: var(--color-card); border: 1px solid var(--color-border); border-radius: 12px; padding: 24px;">
        <p style="margin-bottom: 16px;">Shopify's Agentic Storefronts are <strong>enabled by default</strong> starting
          January 26, 2026. If you want to disable AI agent access to your store:</p>

        <h4 style="margin: 16px 0 8px; color: var(--brand-blue);">Shopify Stores:</h4>
        <ol style="margin-left: 20px; margin-bottom: 16px;">
          <li>Go to <strong>Sales Channels</strong> in your Shopify admin</li>
          <li>Find <strong>Agentic Storefronts</strong> or <strong>Shop</strong> channel</li>
          <li>Click <strong>Settings</strong> and disable the channel</li>
          <li>Remove products from the Shopify Global Catalog</li>
        </ol>

        <h4 style="margin: 16px 0 8px; color: var(--brand-blue);">Block Specific AI Agents:</h4>
        <ul style="margin-left: 20px; margin-bottom: 16px;">
          <li><strong>Amazon Buy for Me:</strong> Use Cloudflare security rules to block Amazon's bot</li>
          <li><strong>robots.txt:</strong> Add <code>User-agent: GPTBot</code> and <code>Disallow: /</code> to block
            ChatGPT</li>
          <li><strong>Google AI:</strong> Currently no opt-out for Google AI Mode with UCP</li>
        </ul>

        <div
          style="background: #fef9c3; border-left: 4px solid #CA8A04; padding: 12px 16px; border-radius: 0 8px 8px 0;">
          <strong style="color: #92400E;">Warning:</strong> Opting out means AI shopping agents won't be able to
          complete purchases on your store. This may reduce discoverability as AI-powered shopping grows.
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p><strong>UCP.tools</strong> &bull; <a href="https://github.com/Universal-Commerce-Protocol/ucp">UCP Spec</a>
        &bull; <a href="#optout">Opt-Out Guide</a> &bull; <a href="mailto:hello@ucptools.dev">Contact</a></p>
      <p style="margin-top: 8px; font-size: 14px;">Independent project. Not affiliated with Google or Shopify. UCP is an
        open protocol.</p>
    </div>
  </footer>

  <script>
    // Switch tab function (called from nav and tab buttons)
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(t => {
        t.classList.toggle('active', t.dataset.tab === tabName);
      });
      // Show/hide panels
      document.getElementById('validate-panel').classList.toggle('hidden', tabName !== 'validate');
      document.getElementById('simulate-panel').classList.toggle('hidden', tabName !== 'simulate');
      document.getElementById('security-panel').classList.toggle('hidden', tabName !== 'security');
      document.getElementById('feed-panel').classList.toggle('hidden', tabName !== 'feed');
      document.getElementById('compliance-panel').classList.toggle('hidden', tabName !== 'compliance');
      document.getElementById('generate-panel').classList.toggle('hidden', tabName !== 'generate');
      document.getElementById('schema-panel').classList.toggle('hidden', tabName !== 'schema');
      // Scroll to hero section
      document.querySelector('.hero').scrollIntoView({ behavior: 'smooth' });
    }

    // Schema template toggles
    document.getElementById('return-template').addEventListener('change', (e) => {
      document.getElementById('custom-return').classList.toggle('hidden', e.target.value !== 'custom');
    });
    document.getElementById('shipping-template').addEventListener('change', (e) => {
      document.getElementById('custom-shipping').classList.toggle('hidden', e.target.value !== 'custom');
    });

    // Generate Schema.org snippets
    async function generateSchema() {
      const btn = document.getElementById('generate-schema-btn');
      const result = document.getElementById('schema-result');

      const returnTemplate = document.getElementById('return-template').value;
      const shippingTemplate = document.getElementById('shipping-template').value;

      btn.disabled = true;
      btn.textContent = 'Generating...';

      try {
        let options = {
          returnPolicy: returnTemplate !== 'custom' ? returnTemplate : undefined,
          shipping: shippingTemplate !== 'custom' ? shippingTemplate : undefined,
        };

        if (returnTemplate === 'custom') {
          options.customReturn = {
            returnDays: parseInt(document.getElementById('return-days').value),
            country: document.getElementById('return-country').value,
            freeReturns: document.getElementById('free-returns').checked,
          };
        }

        if (shippingTemplate === 'custom') {
          options.customShipping = {
            rate: parseFloat(document.getElementById('shipping-rate').value),
            currency: document.getElementById('shipping-currency').value,
            country: document.getElementById('shipping-country').value,
            transitMin: parseInt(document.getElementById('transit-min').value),
            transitMax: parseInt(document.getElementById('transit-max').value),
            handlingMin: parseInt(document.getElementById('handling-min').value),
            handlingMax: parseInt(document.getElementById('handling-max').value),
          };
        }

        const res = await fetch('/api/generate-schema', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type: 'complete', options })
        });
        const data = await res.json();

        if (!data.success) {
          throw new Error(data.error || 'Failed to generate schema');
        }

        window.generatedSchemaCode = data.embedCode;

        result.className = 'result show success';
        result.innerHTML = `
          <p style="margin-bottom: 16px;">\u2713 Schema snippets generated!</p>
          <p style="font-size: 13px; margin-bottom: 12px; color: var(--color-medium);">Copy this code and paste it into your HTML &lt;head&gt; section:</p>
          <pre style="font-size: 12px;">${escapeHtml(data.embedCode)}</pre>
          <div style="margin-top: 16px; display: flex; gap: 12px; flex-wrap: wrap;">
            <button class="btn" onclick="copySchemaCode()">Copy to Clipboard</button>
            <button class="btn btn-secondary" onclick="downloadSchemaCode()">Download HTML</button>
          </div>
          <div style="margin-top: 20px; padding: 16px; background: rgba(46,134,171,0.1); border-radius: 8px;">
            <h4 style="margin-bottom: 8px; font-size: 14px;">Next Steps:</h4>
            <ol style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--color-dark);">
              <li>Paste this code in your HTML &lt;head&gt;</li>
              <li>For product pages, add Product schema with @id references</li>
              <li>Validate at <a href="https://validator.schema.org/" target="_blank" class="link-brand">validator.schema.org</a></li>
              <li>Re-check your AI Readiness score!</li>
            </ol>
          </div>
        `;
      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = `<p>Error: ${err.message}</p>`;
      }

      btn.disabled = false;
      btn.textContent = 'Generate Snippets';
    }

    function copySchemaCode() {
      navigator.clipboard.writeText(window.generatedSchemaCode);
      alert('Copied to clipboard!');
    }

    function downloadSchemaCode() {
      const blob = new Blob([window.generatedSchemaCode], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'schema-snippets.html';
      a.click();
    }

    // Tab button click handlers
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        switchTab(tab.dataset.tab);
      });
    });

    // Validate form
    document.getElementById('validate-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('validate-btn');
      const result = document.getElementById('validate-result');
      const domain = document.getElementById('domain').value.replace(/^https?:\/\//, '').replace(/\/$/, '');

      btn.disabled = true;
      btn.textContent = 'Checking AI Readiness...';
      result.className = 'result';
      result.innerHTML = '';

      try {
        const res = await fetch('/api/validate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ domain })
        });
        const data = await res.json();

        // Use new AI readiness score
        const score = data.ai_readiness?.score ?? 0;
        const grade = data.ai_readiness?.grade ?? 'F';
        const readinessLabel = data.ai_readiness?.label ?? 'Not Ready';

        // Separate issues by category
        const ucpIssues = data.ucp?.issues || [];
        const schemaIssues = data.schema?.issues || [];
        const ucpErrors = ucpIssues.filter(i => i.severity === 'error').length;
        const ucpWarnings = ucpIssues.filter(i => i.severity === 'warn').length;
        const schemaErrors = schemaIssues.filter(i => i.severity === 'error').length;
        const schemaWarnings = schemaIssues.filter(i => i.severity === 'warn').length;

        const levelColors = {
          'ready': '#16A34A',
          'partial': '#CA8A04',
          'limited': '#EA580C',
          'not_ready': '#DC2626'
        };
        const levelColor = levelColors[data.ai_readiness?.level] || '#DC2626';

        result.className = 'result show';
        result.style.background = '#fff';
        result.style.border = 'none';
        result.style.borderRadius = '0';
        result.style.boxShadow = 'none';
        result.style.padding = '0';

        const productCompleteness = data.product_quality?.completeness || 0;
        const productIssues = data.product_quality?.issues || [];
        const shippingIssues = data.shipping?.issues || [];

        // Combine all issues and create fix lookup
        const allIssues = [...ucpIssues, ...schemaIssues, ...productIssues, ...shippingIssues];
        const suggestions = data.lint_suggestions || [];

        // Create issue code to fix mapping from API
        const fixLookup = {};
        suggestions.forEach((s, idx) => {
          if (s.code) fixLookup[s.code] = { ...s, idx };
        });

        // Default fix guidance for common UCP issues
        const defaultFixes = {
          'UCP_INVALID_VERSION': {
            title: 'Fix UCP Version Format',
            fix: 'The version field must use YYYY-MM-DD format (e.g., "2025-01-15"). This indicates when your UCP profile was last updated.',
            code_snippet: '"version": "2025-01-15"'
          },
          'UCP_INVALID_SERVICE': {
            title: 'Complete Service Definition',
            fix: 'Each service in your UCP profile must include: name, version (YYYY-MM-DD format), and spec (URL to OpenAPI specification).',
            code_snippet: `{
  "name": "checkout",
  "version": "2025-01-15",
  "spec": "https://yoursite.com/api/checkout/openapi.json"
}`
          },
          'UCP_NO_TRANSPORT': {
            title: 'Add Transport Binding',
            fix: 'Services need transport bindings to tell AI agents how to communicate. Add at least one transport (usually REST with a base URL).',
            code_snippet: `{
  "name": "checkout",
  "version": "2025-01-15",
  "spec": "https://yoursite.com/api/checkout/openapi.json",
  "transport": [{
    "type": "REST",
    "base_url": "https://yoursite.com/api/checkout"
  }]
}`
          },
          'UCP_INVALID_CAP': {
            title: 'Fix Capability Definition',
            fix: 'Each capability must have: name (what it does), version (YYYY-MM-DD), spec (OpenAPI URL), and schema (JSON Schema URL).',
            code_snippet: `{
  "name": "product-search",
  "version": "2025-01-15",
  "spec": "https://yoursite.com/api/search/openapi.json",
  "schema": "https://yoursite.com/api/search/schema.json"
}`
          },
          'UCP_MISSING_SERVICES': {
            title: 'Add Required Services',
            fix: 'UCP profiles should define services that AI agents can use. Common services include: checkout, products, orders, and cart.',
            doc_link: 'https://ucp.dev/specification/services/'
          },
          'UCP_MISSING_CAPABILITIES': {
            title: 'Add Capabilities',
            fix: 'Capabilities tell AI agents what your store can do. Define capabilities like product-search, cart-management, etc.',
            doc_link: 'https://ucp.dev/specification/capabilities/'
          }
        };

        // Enhanced issue message with context
        const enhanceIssue = (issue) => {
          let enhanced = { ...issue };

          // Extract context from message (e.g., "Service \"checkout\" missing version")
          const serviceMatch = issue.message.match(/Service "([^"]+)"/i);
          const capMatch = issue.message.match(/Capability "([^"]+)"/i);

          if (serviceMatch) {
            enhanced.context = `Service: ${serviceMatch[1]}`;
          } else if (capMatch) {
            enhanced.context = `Capability: ${capMatch[1]}`;
          }

          // Improve cryptic messages
          if (issue.code === 'UCP_INVALID_CAP' && issue.message === 'Missing name') {
            enhanced.message = 'Capability is missing required "name" field';
            enhanced.hint = 'Each capability needs a name that describes what it does (e.g., "product-search", "cart-checkout")';
          }
          if (issue.code === 'UCP_INVALID_CAP' && issue.message === 'Missing version') {
            enhanced.message = 'Capability is missing required "version" field';
            enhanced.hint = 'Add version in YYYY-MM-DD format (e.g., "2025-01-15")';
          }
          if (issue.code === 'UCP_INVALID_CAP' && issue.message === 'Missing spec') {
            enhanced.message = 'Capability is missing required "spec" field';
            enhanced.hint = 'Add URL to your OpenAPI specification file';
          }
          if (issue.code === 'UCP_INVALID_CAP' && issue.message === 'Missing schema') {
            enhanced.message = 'Capability is missing required "schema" field';
            enhanced.hint = 'Add URL to your JSON Schema file';
          }

          return enhanced;
        };

        // Group similar issues for cleaner display
        const groupIssues = (issues) => {
          const groups = {};
          const standalone = [];

          issues.forEach(issue => {
            // Group UCP_INVALID_CAP issues by message type
            if (issue.code === 'UCP_INVALID_CAP') {
              const key = `${issue.code}:${issue.message}`;
              if (!groups[key]) {
                groups[key] = { ...issue, count: 0, items: [] };
              }
              groups[key].count++;
              groups[key].items.push(issue);
            } else {
              standalone.push(issue);
            }
          });

          // Convert groups to array and add to standalone
          Object.values(groups).forEach(group => {
            if (group.count > 1) {
              group.message = `${group.message} (${group.count} capabilities)`;
              group.isGrouped = true;
            }
            standalone.push(group);
          });

          return standalone;
        };

        // Helper to render issue with inline fix
        const renderIssue = (issue, idx) => {
          const enhanced = enhanceIssue(issue);
          const fix = fixLookup[issue.code] || defaultFixes[issue.code];
          const hasSpecificFix = !!fix;

          return `
            <div class="issue-item has-fix" data-issue-idx="${idx}">
              <div class="issue-item-header">
                <span class="issue-severity-dot ${enhanced.severity}"></span>
                <span class="issue-code">${enhanced.code}</span>
                <span class="issue-message">${enhanced.message}</span>
                <span class="issue-has-fix">${hasSpecificFix ? 'Fix' : 'Help'} &#8594;</span>
              </div>
              ${enhanced.context ? '<div class="issue-context">' + enhanced.context + '</div>' : ''}
              ${enhanced.hint ? '<div class="issue-hint">' + enhanced.hint + '</div>' : ''}
              ${hasSpecificFix ? `
              <div class="issue-fix-panel">
                <div class="issue-fix-title">${fix.title}</div>
                <div class="issue-fix-description">${fix.fix}</div>
                ${fix.code_snippet ? `
                <div class="issue-fix-code">
                  <div class="issue-fix-code-header">
                    <span>Example Code</span>
                    <button class="issue-copy-btn" data-snippet="${idx}">Copy</button>
                  </div>
                  <pre><code>${escapeHtml(fix.code_snippet)}</code></pre>
                </div>
                ` : ''}
                <div class="issue-fix-links">
                  ${fix.doc_link ? '<a href="' + fix.doc_link + '" target="_blank">Documentation</a>' : ''}
                  ${fix.generator_link ? '<a href="' + fix.generator_link + '">Generator</a>' : ''}
                  <a href="#generate" onclick="switchTab(\'generate\'); return false;">Use Generator</a>
                </div>
              </div>
              ` : `
              <div class="issue-fix-panel">
                <div class="issue-fix-title">How to Fix</div>
                <div class="issue-fix-description">Use our UCP Generator tool to create a valid UCP profile with all required fields properly configured.</div>
                <div class="issue-fix-links">
                  <a href="#generate" onclick="switchTab('generate'); return false;">Open Generator</a>
                  <a href="https://ucp.dev/specification/overview/" target="_blank">UCP Specification</a>
                </div>
              </div>
              `}
            </div>
          `;
        };

        // Process UCP issues - group similar ones
        const processedUcpIssues = groupIssues(ucpIssues);

        result.innerHTML = `
          <!-- Score Header -->
          <div class="report-header">
            <div class="report-grade grade-${grade}">${grade}</div>
            <div class="report-score-info">
              <div class="report-score">${score}<span>/100</span></div>
              <div class="report-label" style="color: ${levelColor}">${readinessLabel}</div>
            </div>
            ${data.benchmark ? `
            <div class="report-benchmark">
              <div class="report-benchmark-value">${data.benchmark.percentile}%</div>
              <div class="report-benchmark-label">better than ${data.benchmark.total_sites_analyzed} sites</div>
            </div>
            ` : ''}
          </div>

          <!-- Quick Stats -->
          <div class="report-stats">
            <div class="report-stat ${data.ucp?.found ? 'pass' : 'fail'}">
              <div class="report-stat-icon">${data.ucp?.found ? '&#10003;' : '&#10005;'}</div>
              <div class="report-stat-text">UCP Profile</div>
            </div>
            <div class="report-stat ${(data.schema?.stats?.returnPolicies || 0) > 0 ? 'pass' : 'fail'}">
              <div class="report-stat-icon">${(data.schema?.stats?.returnPolicies || 0) > 0 ? '&#10003;' : '&#10005;'}</div>
              <div class="report-stat-text">Return Policy</div>
            </div>
            <div class="report-stat ${(data.schema?.stats?.products || 0) > 0 ? 'pass' : 'warn'}">
              <div class="report-stat-icon">${data.schema?.stats?.products || 0}</div>
              <div class="report-stat-text">Products</div>
            </div>
            <div class="report-stat ${productCompleteness >= 80 ? 'pass' : productCompleteness >= 50 ? 'warn' : 'fail'}">
              <div class="report-stat-icon">${productCompleteness}%</div>
              <div class="report-stat-text">Data Quality</div>
            </div>
          </div>

          <!-- Issues Sections -->
          <div id="report-issues">
            ${ucpIssues.length > 0 || !data.ucp?.found ? `
            <div class="report-section ${ucpIssues.length === 0 && data.ucp?.found ? 'collapsed' : ''}" data-section="ucp">
              <div class="report-section-header">
                <div class="report-section-status ${data.ucp?.found ? (ucpErrors === 0 ? 'pass' : 'fail') : 'fail'}">
                  ${data.ucp?.found ? (ucpErrors === 0 ? '&#10003;' : processedUcpIssues.length) : '&#10005;'}
                </div>
                <div class="report-section-title">
                  <strong>UCP Profile</strong>
                  <span>${data.ucp?.found ? (ucpIssues.length === 0 ? 'Valid' : processedUcpIssues.length + ' issues to fix') : 'Not found - create /.well-known/ucp'}</span>
                </div>
                <div class="report-section-toggle">&#9662;</div>
              </div>
              <div class="report-section-body">
                ${data.ucp?.found && processedUcpIssues.length > 0 ? `
                  <div class="report-ucp-summary">
                    <p>Your UCP profile was found but has configuration issues. Click each issue to see how to fix it.</p>
                  </div>
                ` : ''}
                ${processedUcpIssues.length > 0 ? processedUcpIssues.map((issue, idx) => renderIssue(issue, 'ucp-' + idx)).join('') : `
                  <div class="report-empty-state">
                    <p>Create a UCP profile to enable AI shopping agents on your store.</p>
                    <a href="#generate" onclick="switchTab('generate'); return false;" class="btn btn-secondary">Generate UCP Profile</a>
                  </div>
                `}
              </div>
            </div>
            ` : ''}

            ${schemaIssues.length > 0 || (data.schema?.stats?.products === 0) ? `
            <div class="report-section" data-section="schema">
              <div class="report-section-header">
                <div class="report-section-status ${schemaErrors === 0 ? (schemaWarnings === 0 ? 'pass' : 'warn') : 'fail'}">
                  ${schemaErrors === 0 ? (schemaWarnings === 0 ? '&#10003;' : schemaWarnings) : schemaIssues.length}
                </div>
                <div class="report-section-title">
                  <strong>Schema.org Markup</strong>
                  <span>${schemaIssues.length === 0 ? 'Valid' : schemaIssues.length + ' issues to fix'} &bull; Jan 2026 deadline</span>
                </div>
                <div class="report-section-toggle">&#9662;</div>
              </div>
              <div class="report-section-body">
                <div class="report-schema-stats">
                  <div><strong>${data.schema?.stats?.products || 0}</strong> Products</div>
                  <div><strong>${data.schema?.stats?.returnPolicies || 0}</strong> Return Policies</div>
                  <div><strong>${data.schema?.stats?.orgs || 0}</strong> Organizations</div>
                </div>
                ${schemaIssues.length > 0 ? schemaIssues.map((issue, idx) => renderIssue(issue, 'schema-' + idx)).join('') : ''}
              </div>
            </div>
            ` : ''}

            ${productIssues.length > 0 ? `
            <div class="report-section collapsed" data-section="product">
              <div class="report-section-header">
                <div class="report-section-status ${productCompleteness >= 80 ? 'pass' : 'warn'}">
                  ${productIssues.length}
                </div>
                <div class="report-section-title">
                  <strong>Product Data</strong>
                  <span>${productCompleteness}% complete &bull; ${productIssues.length} suggestions</span>
                </div>
                <div class="report-section-toggle">&#9662;</div>
              </div>
              <div class="report-section-body">
                ${productIssues.map((issue, idx) => renderIssue(issue, 'product-' + idx)).join('')}
              </div>
            </div>
            ` : ''}

            ${shippingIssues.length > 0 ? `
            <div class="report-section collapsed" data-section="shipping">
              <div class="report-section-header">
                <div class="report-section-status warn">
                  ${shippingIssues.length}
                </div>
                <div class="report-section-title">
                  <strong>Shipping Details</strong>
                  <span>${shippingIssues.length} issues</span>
                </div>
                <div class="report-section-toggle">&#9662;</div>
              </div>
              <div class="report-section-body">
                ${shippingIssues.map((issue, idx) => renderIssue(issue, 'shipping-' + idx)).join('')}
              </div>
            </div>
            ` : ''}
          </div>

          <!-- Actions -->
          <div class="report-actions">
            <button class="btn" onclick="downloadPdfReport()">&#128196; Download PDF Report</button>
            <a href="/verify?domain=${encodeURIComponent(domain)}" target="_blank" class="btn btn-secondary">&#128279; Share Results</a>
            ${score >= 50 ? '<button class="btn btn-secondary" onclick="copyBadgeCode(\'' + domain + '\')">&#127942; Get Badge</button>' : ''}
          </div>
        `;

        // Store validation data for report generation
        window.lastValidatedDomain = domain;
        window.lastValidationData = data;
        window.lintSuggestions = data.lint_suggestions || [];

        // Setup event delegation for report sections and issues
        const reportIssues = document.getElementById('report-issues');
        if (reportIssues) {
          reportIssues.addEventListener('click', function(e) {
            // Handle report section header click (expand/collapse section)
            const sectionHeader = e.target.closest('.report-section-header');
            if (sectionHeader) {
              const section = sectionHeader.closest('.report-section');
              if (section) {
                section.classList.toggle('collapsed');
              }
              return;
            }

            // Handle issue item header click (expand/collapse fix panel)
            const issueHeader = e.target.closest('.issue-item-header');
            if (issueHeader) {
              const issueItem = issueHeader.closest('.issue-item');
              if (issueItem) {
                // Only toggle if this issue has a fix panel
                const fixPanel = issueItem.querySelector('.issue-fix-panel');
                if (fixPanel) {
                  issueItem.classList.toggle('expanded');
                }
              }
              return;
            }

            // Handle copy button click
            const copyBtn = e.target.closest('.issue-copy-btn');
            if (copyBtn) {
              e.stopPropagation();
              const pre = copyBtn.closest('.issue-fix-code').querySelector('code');
              if (pre) {
                navigator.clipboard.writeText(pre.textContent).then(() => {
                  copyBtn.textContent = 'Copied!';
                  copyBtn.classList.add('copied');
                  setTimeout(() => {
                    copyBtn.textContent = 'Copy';
                    copyBtn.classList.remove('copied');
                  }, 2000);
                });
              }
              return;
            }
          });
        }
      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = `<p>Error: ${err.message}</p>`;
      }

      btn.disabled = false;
      btn.textContent = 'Check AI Readiness';
    });

    function copyBadgeCode(domain) {
      const code = '<a href="https://ucptools.dev/verify?domain=' + encodeURIComponent(domain) + '"><img src="https://ucptools.dev/api/badge?domain=' + encodeURIComponent(domain) + '" alt="AI Commerce Ready"></a>';
      navigator.clipboard.writeText(code);
      alert('Badge code copied to clipboard!');
    }

    // PDF Report Generation (Issue #7)
    function downloadPdfReport() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      const data = window.lastValidationData;
      const domain = window.lastValidatedDomain;

      if (!data || !domain) {
        alert('No validation data available. Please run a validation first.');
        return;
      }

      const pageWidth = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();
      const margin = 20;
      const contentWidth = pageWidth - (margin * 2);

      const score = data.ai_readiness?.score ?? 0;
      const grade = data.ai_readiness?.grade ?? 'F';
      const readinessLabel = data.ai_readiness?.label ?? 'Not Ready';

      // Brand Colors
      const colors = {
        brandBlue: [46, 134, 171],
        brandTeal: [54, 181, 162],
        brandGreen: [71, 201, 122],
        dark: [26, 43, 60],
        medium: [90, 105, 120],
        light: [148, 163, 184],
        border: [226, 232, 240],
        background: [248, 250, 252],
        white: [255, 255, 255],
        gradeA: [22, 163, 74],
        gradeB: [37, 99, 235],
        gradeC: [202, 138, 4],
        gradeD: [234, 88, 12],
        gradeF: [220, 38, 38],
        error: [220, 38, 38],
        warning: [202, 138, 4],
        success: [22, 163, 74],
        info: [37, 99, 235]
      };

      const gradeColorMap = { A: colors.gradeA, B: colors.gradeB, C: colors.gradeC, D: colors.gradeD, F: colors.gradeF };
      const gradeColor = gradeColorMap[grade] || colors.gradeF;

      // Helper functions
      const setColor = (color, type = 'text') => {
        if (type === 'text') doc.setTextColor(...color);
        else if (type === 'fill') doc.setFillColor(...color);
        else if (type === 'draw') doc.setDrawColor(...color);
      };

      const drawRoundedRect = (x, y, w, h, r, fillColor, strokeColor = null) => {
        setColor(fillColor, 'fill');
        doc.roundedRect(x, y, w, h, r, r, strokeColor ? 'FD' : 'F');
        if (strokeColor) {
          setColor(strokeColor, 'draw');
          doc.roundedRect(x, y, w, h, r, r, 'S');
        }
      };

      const addText = (text, x, y, options = {}) => {
        const { size = 10, style = 'normal', color = colors.dark, align = 'left', maxWidth = null } = options;
        doc.setFontSize(size);
        doc.setFont('helvetica', style);
        setColor(color);
        if (maxWidth) {
          doc.text(text, x, y, { maxWidth, align });
        } else {
          doc.text(text, x, y, { align });
        }
      };

      let y = 0;

      // ============ HEADER ============
      // Gradient header background
      const headerHeight = 55;
      // Draw gradient effect with multiple rectangles
      for (let i = 0; i < headerHeight; i++) {
        const ratio = i / headerHeight;
        const r = Math.round(colors.brandBlue[0] + (colors.brandTeal[0] - colors.brandBlue[0]) * ratio);
        const g = Math.round(colors.brandBlue[1] + (colors.brandTeal[1] - colors.brandBlue[1]) * ratio);
        const b = Math.round(colors.brandBlue[2] + (colors.brandTeal[2] - colors.brandBlue[2]) * ratio);
        doc.setFillColor(r, g, b);
        doc.rect(0, i, pageWidth, 1, 'F');
      }

      // Logo and title
      addText('UCP.tools', margin, 22, { size: 28, style: 'bold', color: colors.white });
      addText('AI Commerce Readiness Report', margin, 32, { size: 12, color: [255, 255, 255, 200] });

      // Report date and ID
      const dateStr = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      const timeStr = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
      addText(dateStr, pageWidth - margin, 22, { size: 10, color: colors.white, align: 'right' });
      addText(timeStr, pageWidth - margin, 30, { size: 9, color: [255, 255, 255, 180], align: 'right' });

      // Domain badge in header
      const domainText = domain.length > 35 ? domain.substring(0, 35) + '...' : domain;
      addText(domainText, margin, 46, { size: 14, style: 'bold', color: colors.white });

      y = headerHeight + 15;

      // ============ EXECUTIVE SUMMARY CARD ============
      const summaryCardHeight = 65;
      drawRoundedRect(margin, y, contentWidth, summaryCardHeight, 4, colors.white);
      doc.setDrawColor(...colors.border);
      doc.setLineWidth(0.5);
      doc.roundedRect(margin, y, contentWidth, summaryCardHeight, 4, 4, 'S');

      // Grade circle with ring indicator
      const gradeCircleX = margin + 30;
      const gradeCircleY = y + summaryCardHeight / 2;
      const gradeCircleR = 22;
      const ringR = 25;

      // Draw outer ring (score indicator)
      doc.setDrawColor(...colors.border);
      doc.setLineWidth(3);
      doc.circle(gradeCircleX, gradeCircleY, ringR, 'S');

      // Draw score arc (colored portion)
      const scoreAngle = (score / 100) * 360;
      doc.setDrawColor(...gradeColor);
      doc.setLineWidth(3);
      // Approximate arc with multiple small lines for the score portion
      for (let angle = -90; angle < -90 + scoreAngle; angle += 5) {
        const rad = (angle * Math.PI) / 180;
        const nextRad = ((angle + 5) * Math.PI) / 180;
        const x1 = gradeCircleX + ringR * Math.cos(rad);
        const y1 = gradeCircleY + ringR * Math.sin(rad);
        const x2 = gradeCircleX + ringR * Math.cos(nextRad);
        const y2 = gradeCircleY + ringR * Math.sin(nextRad);
        doc.line(x1, y1, x2, y2);
      }

      // Draw grade circle with color
      setColor(gradeColor, 'fill');
      doc.circle(gradeCircleX, gradeCircleY, gradeCircleR, 'F');

      // Grade letter
      addText(grade, gradeCircleX, gradeCircleY + 8, { size: 36, style: 'bold', color: colors.white, align: 'center' });

      // Score and label
      const scoreX = margin + 70;
      addText(`${score}/100`, scoreX, y + 20, { size: 32, style: 'bold', color: colors.dark });
      addText(readinessLabel, scoreX, y + 32, { size: 14, style: 'bold', color: gradeColor });
      addText('AI Commerce Readiness Score', scoreX, y + 42, { size: 10, color: colors.medium });

      // Benchmark info on the right
      if (data.benchmark) {
        const benchX = pageWidth - margin - 55;
        drawRoundedRect(benchX - 5, y + 10, 60, 45, 3, colors.background);
        addText('BENCHMARK', benchX + 25, y + 22, { size: 8, style: 'bold', color: colors.medium, align: 'center' });
        addText(`Top ${100 - data.benchmark.percentile}%`, benchX + 25, y + 35, { size: 16, style: 'bold', color: colors.brandBlue, align: 'center' });
        addText(`of ${data.benchmark.total_sites_analyzed.toLocaleString()} sites`, benchX + 25, y + 45, { size: 8, color: colors.medium, align: 'center' });
      }

      y += summaryCardHeight + 12;

      // ============ STATUS OVERVIEW (4 columns) ============
      const colWidth = (contentWidth - 15) / 4;
      const statusHeight = 50;

      // UCP Status
      const ucpFound = data.ucp?.found ?? false;
      const ucpIssues = data.ucp?.issues || [];
      const ucpErrors = ucpIssues.filter(i => i.severity === 'error').length;
      const ucpWarnings = ucpIssues.filter(i => i.severity === 'warn').length;

      drawRoundedRect(margin, y, colWidth, statusHeight, 3, ucpFound ? [240, 253, 244] : [254, 242, 242]);
      addText('UCP Profile', margin + 8, y + 12, { size: 9, style: 'bold', color: colors.medium });
      addText(ucpFound ? '‚úì Found' : '‚úó Not Found', margin + 8, y + 24, {
        size: 14, style: 'bold', color: ucpFound ? colors.success : colors.error
      });
      addText(`${ucpErrors} errors ¬∑ ${ucpWarnings} warnings`, margin + 8, y + 36, { size: 8, color: colors.medium });
      if (data.ucp?.version) {
        addText(`v${data.ucp.version}`, margin + colWidth - 8, y + 12, { size: 8, color: colors.medium, align: 'right' });
      }

      // Schema Status
      const schemaX = margin + colWidth + 5;
      const schemaStats = data.schema?.stats || {};
      const hasSchema = schemaStats.products > 0 || schemaStats.returnPolicies > 0;
      const schemaIssues = data.schema?.issues || [];
      const schemaErrors = schemaIssues.filter(i => i.severity === 'error').length;
      const schemaWarnings = schemaIssues.filter(i => i.severity === 'warn').length;

      drawRoundedRect(schemaX, y, colWidth, statusHeight, 3, hasSchema ? [240, 249, 255] : [254, 242, 242]);
      addText('Schema.org', schemaX + 6, y + 12, { size: 8, style: 'bold', color: colors.medium });
      addText(`${schemaStats.products || 0} Products`, schemaX + 6, y + 24, { size: 12, style: 'bold', color: colors.brandBlue });
      addText(`${schemaStats.returnPolicies || 0} Returns`, schemaX + 6, y + 36, { size: 7, color: colors.medium });

      // Product Quality Status
      const productX = margin + (colWidth * 2) + 10;
      const productCompleteness = data.product_quality?.completeness || 0;
      const productColor = productCompleteness >= 80 ? [240, 253, 244] : productCompleteness >= 60 ? [255, 251, 235] : [254, 242, 242];
      drawRoundedRect(productX, y, colWidth, statusHeight, 3, productColor);
      addText('Data Quality', productX + 6, y + 12, { size: 8, style: 'bold', color: colors.medium });
      addText(`${productCompleteness}%`, productX + 6, y + 24, { size: 12, style: 'bold', color: productCompleteness >= 80 ? colors.success : productCompleteness >= 60 ? colors.warning : colors.error });
      addText('Completeness', productX + 6, y + 36, { size: 7, color: colors.medium });

      // Compliance Status
      const compX = margin + (colWidth * 3) + 15;
      const isCompliant = schemaStats.returnPolicies > 0 && ucpFound;
      drawRoundedRect(compX, y, colWidth, statusHeight, 3, isCompliant ? [240, 253, 244] : [255, 251, 235]);
      addText('Jan 2026', compX + 6, y + 12, { size: 8, style: 'bold', color: colors.medium });
      addText(isCompliant ? 'Ready' : 'Action Req.', compX + 6, y + 24, {
        size: 12, style: 'bold', color: isCompliant ? colors.success : colors.warning
      });
      const missingItems = [];
      if (!ucpFound) missingItems.push('UCP');
      if (schemaStats.returnPolicies === 0) missingItems.push('Returns');
      addText(isCompliant ? 'All met' : missingItems.join(', '), compX + 6, y + 36, { size: 7, color: colors.medium });

      y += statusHeight + 15;

      // ============ ISSUES & FIXES (Combined View) ============
      const allIssues = [...(data.ucp?.issues || []), ...(data.schema?.issues || []), ...(data.product_quality?.issues || [])];
      const suggestions = data.lint_suggestions || [];

      // Create a mapping of issue codes to their fixes
      const issueCodeToFix = {};
      suggestions.forEach(s => {
        if (s.code) {
          // Map the suggestion code back to issue codes it addresses
          const relatedCodes = [];
          if (s.code.includes('VERSION')) relatedCodes.push('UCP_INVALID_VERSION');
          if (s.code.includes('RETURN') || s.code === 'SCHEMA_NO_RETURN') relatedCodes.push('SCHEMA_NO_RETURN');
          if (s.code.includes('SHIPPING') || s.code === 'SCHEMA_NO_SHIPPING') relatedCodes.push('SCHEMA_NO_SHIPPING');
          if (s.code.includes('TRANSPORT') || s.code === 'UCP_NO_TRANSPORT') relatedCodes.push('UCP_NO_TRANSPORT');
          if (s.code.includes('SERVICE') || s.code === 'UCP_INVALID_SERVICE') relatedCodes.push('UCP_INVALID_SERVICE');
          if (s.code.includes('CAP') || s.code === 'UCP_INVALID_CAP') relatedCodes.push('UCP_INVALID_CAP');
          if (s.code.includes('PRODUCT') || s.code === 'SCHEMA_NO_PRODUCT') relatedCodes.push('SCHEMA_NO_PRODUCT');
          if (s.code.includes('CHECKOUT')) relatedCodes.push('UCP_NO_CHECKOUT');
          relatedCodes.forEach(rc => { issueCodeToFix[rc] = s; });
          // Also direct mapping
          issueCodeToFix[s.code] = s;
        }
      });

      if (allIssues.length > 0) {
        addText(`Issues Found (${allIssues.length} total)`, margin, y, { size: 14, style: 'bold', color: colors.dark });
        y += 8;

        // Show ALL issues in a compact table format
        const tableData = allIssues.map(issue => {
          const severity = issue.severity === 'error' ? 'ERROR' : 'WARNING';
          const message = issue.message.length > 50 ? issue.message.substring(0, 50) + '...' : issue.message;
          // Find related fix
          const fix = issueCodeToFix[issue.code];
          const fixRef = fix ? fix.title.substring(0, 25) + (fix.title.length > 25 ? '...' : '') : '-';
          return [severity, issue.code || '-', message, fixRef];
        });

        doc.autoTable({
          startY: y,
          head: [['Severity', 'Code', 'Issue', 'Fix']],
          body: tableData,
          margin: { left: margin, right: margin },
          styles: {
            fontSize: 7,
            cellPadding: 2,
            lineColor: colors.border,
            lineWidth: 0.1
          },
          headStyles: {
            fillColor: colors.dark,
            textColor: colors.white,
            fontStyle: 'bold',
            fontSize: 7
          },
          columnStyles: {
            0: { cellWidth: 18, fontStyle: 'bold' },
            1: { cellWidth: 32, fontSize: 6 },
            2: { cellWidth: 'auto' },
            3: { cellWidth: 35, fontSize: 6, textColor: colors.brandBlue }
          },
          alternateRowStyles: { fillColor: colors.background },
          didParseCell: function (cellData) {
            if (cellData.section === 'body' && cellData.column.index === 0) {
              if (cellData.cell.raw === 'ERROR') {
                cellData.cell.styles.textColor = colors.error;
              } else {
                cellData.cell.styles.textColor = colors.warning;
              }
            }
            // Highlight fix column
            if (cellData.section === 'body' && cellData.column.index === 3 && cellData.cell.raw !== '-') {
              cellData.cell.styles.textColor = colors.brandBlue;
              cellData.cell.styles.fontStyle = 'bold';
            }
          }
        });

        y = doc.lastAutoTable.finalY + 12;
      }

      // ============ HOW TO FIX (Detailed Actions) ============
      if (suggestions.length > 0 && y < pageHeight - 60) {
        addText('How to Fix', margin, y, { size: 14, style: 'bold', color: colors.dark });
        y += 3;
        addText('Each fix addresses one or more issues listed above', margin, y + 5, { size: 8, color: colors.medium });
        y += 12;

        const maxSuggestions = Math.min(suggestions.length, y < 200 ? 8 : 5);
        suggestions.slice(0, maxSuggestions).forEach((suggestion, idx) => {
          if (y > pageHeight - 35) return;

          const severityColor = suggestion.severity === 'critical' ? colors.error :
            suggestion.severity === 'warning' ? colors.warning : colors.info;

          // Priority badge with number
          drawRoundedRect(margin, y, 16, 6, 2, severityColor);
          addText(`${idx + 1}`, margin + 8, y + 4.5, { size: 7, style: 'bold', color: colors.white, align: 'center' });

          // Issue code badge (shows which issue this fixes)
          const codeText = suggestion.code ? suggestion.code : '';
          if (codeText) {
            const codeWidth = Math.min(codeText.length * 1.8 + 6, 40);
            drawRoundedRect(margin + 18, y, codeWidth, 6, 2, colors.background);
            addText(codeText, margin + 18 + codeWidth/2, y + 4.5, { size: 6, color: colors.medium, align: 'center' });
          }

          // Title
          addText(suggestion.title, margin + (codeText ? 62 : 22), y + 4.5, { size: 9, style: 'bold', color: colors.dark });
          y += 8;

          // Impact/description
          const impactText = suggestion.impact || suggestion.fix || '';
          if (impactText) {
            addText(impactText.substring(0, 90) + (impactText.length > 90 ? '...' : ''), margin + 18, y, { size: 7, color: colors.medium, maxWidth: contentWidth - 20 });
            y += 7;
          }
          y += 2;
        });

        if (suggestions.length > maxSuggestions) {
          addText(`+ ${suggestions.length - maxSuggestions} more fixes - see full report at ucptools.dev`, margin, y, { size: 7, color: colors.medium });
          y += 8;
        }
      }

      // ============ FOOTER ============
      const footerY = pageHeight - 20;

      // Footer line
      doc.setDrawColor(...colors.border);
      doc.setLineWidth(0.5);
      doc.line(margin, footerY - 5, pageWidth - margin, footerY - 5);

      // Footer content
      addText('Generated by UCP.tools', margin, footerY, { size: 8, color: colors.medium });
      addText('ucptools.dev', margin, footerY + 5, { size: 8, style: 'bold', color: colors.brandBlue });

      // QR code substitute - call to action
      drawRoundedRect(pageWidth - margin - 55, footerY - 8, 55, 18, 2, colors.background);
      addText('Validate your store:', pageWidth - margin - 52, footerY - 1, { size: 7, color: colors.medium });
      addText('ucptools.dev', pageWidth - margin - 52, footerY + 6, { size: 9, style: 'bold', color: colors.brandBlue });

      // Page number
      addText('Page 1 of 1', pageWidth / 2, footerY + 5, { size: 8, color: colors.light, align: 'center' });

      // Download
      doc.save(`ucp-report-${domain.replace(/[^a-zA-Z0-9]/g, '-')}.pdf`);

      // Track download
      if (typeof gtag === 'function') {
        gtag('event', 'download_report', { domain: domain, score: score, grade: grade });
      }
    }

    // Close dropdowns helper
    function closeDropdowns() {
      // Dropdowns auto-close via CSS :hover, but this helps on touch devices
    }

    // Generate form
    document.getElementById('generate-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('generate-btn');
      const result = document.getElementById('generate-result');

      const domain = document.getElementById('gen-domain').value.replace(/^https?:\/\//, '').replace(/\/$/, '');
      const endpoint = document.getElementById('gen-endpoint').value;
      const capabilities = {
        checkout: true,
        order: document.getElementById('cap-order').checked,
        fulfillment: document.getElementById('cap-fulfillment').checked,
        discount: document.getElementById('cap-discount').checked,
      };

      btn.disabled = true;
      btn.textContent = 'Generating...';

      try {
        const res = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ domain, endpoint, capabilities })
        });
        const data = await res.json();

        const profileJson = JSON.stringify(data.profile, null, 2);

        result.className = 'result show success';
        result.innerHTML = `
          <p style="margin-bottom: 16px;">\u2713 Profile generated! Copy the JSON below:</p>
          <pre>${escapeHtml(profileJson)}</pre>
          <div style="margin-top: 16px; display: flex; gap: 12px;">
            <button class="btn" onclick="downloadProfile('${domain}')">Download JSON</button>
            <button class="btn btn-secondary" onclick="copyProfile()">Copy to Clipboard</button>
          </div>
          <p style="margin-top: 16px; font-size: 14px;" class="text-muted">
            Deploy to <code>https://${domain}/.well-known/ucp</code> &bull;
            <a href="#" onclick="showInstructions(); return false;" class="link-brand">See setup instructions \u2192</a>
          </p>
        `;

        window.generatedProfile = profileJson;
      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = `<p>Error: ${err.message}</p>`;
      }

      btn.disabled = false;
      btn.textContent = 'Generate Profile';
    });

    function escapeHtml(str) {
      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    function downloadProfile(domain) {
      const blob = new Blob([window.generatedProfile], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ucp.json';
      a.click();
    }

    function copyProfile() {
      navigator.clipboard.writeText(window.generatedProfile);
      alert('Copied to clipboard!');
    }

    function showInstructions() {
      alert('Setup instructions:\n\n1. Upload ucp.json to your server\n2. Configure your web server to serve it at /.well-known/ucp\n3. Set Content-Type: application/json\n4. Add CORS headers: Access-Control-Allow-Origin: *\n\nSee our documentation for platform-specific guides.');
    }

    // AI Agent Simulation form
    document.getElementById('simulate-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('simulate-btn');
      const result = document.getElementById('simulate-result');
      const domain = document.getElementById('simulate-domain').value.replace(/^https?:\/\//, '').replace(/\/$/, '');

      btn.disabled = true;
      btn.textContent = 'üîÑ Running Simulation...';
      result.className = 'result';
      result.innerHTML = '';

      try {
        const res = await fetch('/api/simulate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ domain })
        });
        const data = await res.json();

        if (data.error) {
          throw new Error(data.message || data.error);
        }

        const score = data.score || 0;
        const grade = data.grade || 'F';

        // Grade colors
        const gradeColors = {
          'A': { bg: '#dcfce7', border: '#86efac', text: '#16A34A' },
          'B': { bg: '#dbeafe', border: '#93c5fd', text: '#2563EB' },
          'C': { bg: '#fef9c3', border: '#fde047', text: '#CA8A04' },
          'D': { bg: '#fed7aa', border: '#fdba74', text: '#EA580C' },
          'F': { bg: '#fee2e2', border: '#fca5a5', text: '#DC2626' },
        };
        const colors = gradeColors[grade] || gradeColors['F'];

        result.className = 'result show';
        result.style.background = colors.bg;
        result.style.border = '1px solid ' + colors.border;

        // Build step results HTML
        const renderSteps = (steps) => {
          if (!steps || steps.length === 0) return '';
          return steps.map(s => {
            const icons = { passed: '‚úÖ', failed: '‚ùå', warning: '‚ö†Ô∏è', skipped: '‚è≠Ô∏è' };
            const icon = icons[s.status] || '‚Ä¢';
            const bgColors = { passed: 'rgba(22,163,74,0.1)', failed: 'rgba(220,38,38,0.1)', warning: 'rgba(202,138,4,0.1)', skipped: 'rgba(100,116,139,0.1)' };
            return `<div style="padding: 8px 12px; margin: 4px 0; border-radius: 6px; background: ${bgColors[s.status] || 'transparent'}; font-size: 13px;">
              <span style="margin-right: 8px;">${icon}</span>
              <strong>${s.step}</strong>: ${s.message}
              ${s.details ? `<br><small style="color: #666; margin-left: 28px;">${s.details}</small>` : ''}
            </div>`;
          }).join('');
        };

        result.innerHTML = `
          <!-- Score Header -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
            <div>
              <span class="score-badge ${grade}">${grade} ${score}/100</span>
              <span style="margin-left: 12px; font-weight: 600; color: ${colors.text};">AI Agent ${data.ok ? 'Ready' : 'Not Ready'}</span>
            </div>
            <span style="font-size: 13px; color: #666;">Completed in ${data.duration_ms}ms</span>
          </div>

          <!-- Summary Stats -->
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
            <div style="text-align: center; padding: 12px; background: rgba(22,163,74,0.1); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: 700; color: #16A34A;">${data.summary?.passed || 0}</div>
              <div style="font-size: 12px; color: #666;">Passed</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(220,38,38,0.1); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: 700; color: #DC2626;">${data.summary?.failed || 0}</div>
              <div style="font-size: 12px; color: #666;">Failed</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(202,138,4,0.1); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: 700; color: #CA8A04;">${data.summary?.warnings || 0}</div>
              <div style="font-size: 12px; color: #666;">Warnings</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(100,116,139,0.1); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: 700; color: #64748B;">${data.summary?.skipped || 0}</div>
              <div style="font-size: 12px; color: #666;">Skipped</div>
            </div>
          </div>

          <!-- Discovery Flow -->
          <div style="margin-bottom: 16px; padding: 16px; background: rgba(46,134,171,0.1); border-radius: 8px;">
            <h4 style="margin-bottom: 12px; color: #2E86AB; display: flex; align-items: center; gap: 8px;">
              <span>üîç Discovery Flow</span>
              ${data.discovery?.success ? '<span style="font-size: 12px; padding: 2px 8px; background: #dcfce7; color: #16A34A; border-radius: 12px;">Success</span>' : '<span style="font-size: 12px; padding: 2px 8px; background: #fee2e2; color: #DC2626; border-radius: 12px;">Failed</span>'}
            </h4>
            ${data.discovery?.profile_url ? `<p style="margin-bottom: 8px; font-size: 13px;">Profile: <code>${data.discovery.profile_url}</code></p>` : ''}
            ${data.discovery?.services?.length > 0 ? `<p style="margin-bottom: 8px; font-size: 13px;">Services: ${data.discovery.services.join(', ')}</p>` : ''}
            ${data.discovery?.capabilities?.length > 0 ? `<p style="margin-bottom: 8px; font-size: 13px;">Capabilities: ${data.discovery.capabilities.join(', ')}</p>` : ''}
            ${data.discovery?.transports?.length > 0 ? `<p style="margin-bottom: 8px; font-size: 13px;">Transports: ${data.discovery.transports.join(', ')}</p>` : ''}
            <details style="margin-top: 8px;">
              <summary style="cursor: pointer; font-size: 13px; color: #2E86AB;">View step details</summary>
              <div style="margin-top: 8px;">${renderSteps(data.discovery?.steps)}</div>
            </details>
          </div>

          <!-- REST API Test -->
          ${data.rest_api ? `
          <div style="margin-bottom: 16px; padding: 16px; background: rgba(99,102,241,0.1); border-radius: 8px;">
            <h4 style="margin-bottom: 12px; color: #6366F1; display: flex; align-items: center; gap: 8px;">
              <span>üåê REST API Test</span>
              ${data.rest_api.success ? '<span style="font-size: 12px; padding: 2px 8px; background: #dcfce7; color: #16A34A; border-radius: 12px;">Success</span>' : '<span style="font-size: 12px; padding: 2px 8px; background: #fee2e2; color: #DC2626; border-radius: 12px;">Issues Found</span>'}
            </h4>
            <p style="font-size: 13px;">Schema: ${data.rest_api.schema_loaded ? '‚úÖ Loaded' : '‚ùå Not loaded'} | Endpoint: ${data.rest_api.endpoint_accessible ? '‚úÖ Accessible' : '‚ùå Not accessible'}</p>
            <details style="margin-top: 8px;">
              <summary style="cursor: pointer; font-size: 13px; color: #6366F1;">View step details</summary>
              <div style="margin-top: 8px;">${renderSteps(data.rest_api?.steps)}</div>
            </details>
          </div>
          ` : ''}

          <!-- Checkout Flow -->
          ${data.checkout ? `
          <div style="margin-bottom: 16px; padding: 16px; background: rgba(71,201,122,0.1); border-radius: 8px;">
            <h4 style="margin-bottom: 12px; color: #36B5A2; display: flex; align-items: center; gap: 8px;">
              <span>üõí Checkout Flow</span>
              ${data.checkout.success ? '<span style="font-size: 12px; padding: 2px 8px; background: #dcfce7; color: #16A34A; border-radius: 12px;">Ready</span>' : '<span style="font-size: 12px; padding: 2px 8px; background: #fef9c3; color: #CA8A04; border-radius: 12px;">Incomplete</span>'}
            </h4>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; font-size: 13px; margin-bottom: 8px;">
              <span>${data.checkout.can_create_checkout ? '‚úÖ' : '‚ùå'} Checkout</span>
              <span>${data.checkout.order_flow_supported ? '‚úÖ' : '‚ö™'} Order Tracking</span>
              <span>${data.checkout.fulfillment_supported ? '‚úÖ' : '‚ö™'} Fulfillment</span>
            </div>
            <details style="margin-top: 8px;">
              <summary style="cursor: pointer; font-size: 13px; color: #36B5A2;">View step details</summary>
              <div style="margin-top: 8px;">${renderSteps(data.checkout?.steps)}</div>
            </details>
          </div>
          ` : ''}

          <!-- Payment Readiness -->
          ${data.payment ? `
          <div style="margin-bottom: 16px; padding: 16px; background: rgba(245,158,11,0.1); border-radius: 8px;">
            <h4 style="margin-bottom: 12px; color: #D97706; display: flex; align-items: center; gap: 8px;">
              <span>üí≥ Payment Readiness</span>
              ${data.payment.success ? '<span style="font-size: 12px; padding: 2px 8px; background: #dcfce7; color: #16A34A; border-radius: 12px;">Configured</span>' : '<span style="font-size: 12px; padding: 2px 8px; background: #fef9c3; color: #CA8A04; border-radius: 12px;">Needs Config</span>'}
            </h4>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; font-size: 13px; margin-bottom: 8px;">
              <span>${data.payment.handlers_found > 0 ? '‚úÖ' : '‚ùå'} Payment Handlers (${data.payment.handlers_found})</span>
              <span>${data.payment.signing_key_valid ? '‚úÖ' : '‚ö™'} Webhook Signing Keys</span>
            </div>
            <details style="margin-top: 8px;">
              <summary style="cursor: pointer; font-size: 13px; color: #D97706;">View step details</summary>
              <div style="margin-top: 8px;">${renderSteps(data.payment?.steps)}</div>
            </details>
          </div>
          ` : ''}

          <!-- Recommendations -->
          ${data.recommendations && data.recommendations.length > 0 ? `
          <div style="padding: 16px; background: linear-gradient(135deg, rgba(46,134,171,0.1), rgba(71,201,122,0.1)); border-radius: 8px;">
            <h4 style="margin-bottom: 12px; color: var(--color-dark);">üí° Recommendations</h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 14px; color: var(--color-dark);">
              ${data.recommendations.map(r => `<li style="margin-bottom: 8px;">${r}</li>`).join('')}
            </ul>
          </div>
          ` : ''}
        `;

      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = `<p>‚ùå Simulation failed: ${err.message}</p><p style="font-size: 13px; margin-top: 8px;">Make sure the domain has a valid UCP profile at /.well-known/ucp</p>`;
      }

      btn.disabled = false;
      btn.textContent = 'üöÄ Run AI Agent Simulation';
    });

    // Security Scanner form
    document.getElementById('security-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('security-btn');
      const result = document.getElementById('security-result');
      const domain = document.getElementById('security-domain').value.replace(/^https?:\/\//, '').replace(/\/$/, '');

      btn.disabled = true;
      btn.textContent = 'üîÑ Running Security Scan...';
      result.className = 'result';
      result.innerHTML = '';

      try {
        const res = await fetch('/api/security-scan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ domain })
        });
        const data = await res.json();

        if (data.error) {
          throw new Error(data.message || data.error);
        }

        const score = data.score || 0;
        const grade = data.grade || 'F';

        // Grade colors
        const gradeColors = {
          'A': { bg: '#dcfce7', border: '#86efac', text: '#16A34A' },
          'B': { bg: '#dbeafe', border: '#93c5fd', text: '#2563EB' },
          'C': { bg: '#fef9c3', border: '#fde047', text: '#CA8A04' },
          'D': { bg: '#fed7aa', border: '#fdba74', text: '#EA580C' },
          'F': { bg: '#fee2e2', border: '#fca5a5', text: '#DC2626' },
        };
        const colors = gradeColors[grade] || gradeColors['F'];

        // Severity colors
        const severityColors = {
          'critical': { bg: 'rgba(127,29,29,0.1)', text: '#7F1D1D', icon: 'üî¥' },
          'high': { bg: 'rgba(220,38,38,0.1)', text: '#DC2626', icon: 'üü†' },
          'medium': { bg: 'rgba(202,138,4,0.1)', text: '#CA8A04', icon: 'üü°' },
          'low': { bg: 'rgba(37,99,235,0.1)', text: '#2563EB', icon: 'üîµ' },
          'info': { bg: 'rgba(100,116,139,0.1)', text: '#64748B', icon: '‚ÑπÔ∏è' },
        };

        // Status icons
        const statusIcons = { pass: '‚úÖ', fail: '‚ùå', warn: '‚ö†Ô∏è', skip: '‚è≠Ô∏è' };

        result.className = 'result show';
        result.style.background = colors.bg;
        result.style.border = '1px solid ' + colors.border;

        // Render security checks
        const renderChecks = (checks) => {
          if (!checks || checks.length === 0) return '<p>No checks performed</p>';
          return checks.map(c => {
            const sevColors = severityColors[c.severity] || severityColors['info'];
            const statusBg = c.status === 'pass' ? 'rgba(22,163,74,0.1)' :
                            c.status === 'fail' ? 'rgba(220,38,38,0.1)' :
                            c.status === 'warn' ? 'rgba(202,138,4,0.1)' :
                            'rgba(100,116,139,0.1)';
            return `
              <div style="padding: 12px 16px; margin: 8px 0; border-radius: 8px; background: ${statusBg}; border-left: 4px solid ${sevColors.text};">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 16px;">${statusIcons[c.status] || '‚Ä¢'}</span>
                    <strong style="color: var(--color-dark);">${c.name}</strong>
                    <span style="font-size: 11px; padding: 2px 6px; background: ${sevColors.bg}; color: ${sevColors.text}; border-radius: 4px; text-transform: uppercase;">${c.severity}</span>
                  </div>
                </div>
                <p style="margin: 8px 0 0 28px; font-size: 13px; color: var(--color-medium);">${c.details || c.description}</p>
                ${c.recommendation ? `<p style="margin: 4px 0 0 28px; font-size: 12px; color: ${sevColors.text};"><strong>Fix:</strong> ${c.recommendation}</p>` : ''}
              </div>
            `;
          }).join('');
        };

        result.innerHTML = `
          <!-- Score Header -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
            <div>
              <span class="score-badge ${grade}">${grade} ${score}/100</span>
              <span style="margin-left: 12px; font-weight: 600; color: ${colors.text};">Security ${data.ok ? 'Good' : 'Needs Attention'}</span>
            </div>
            <span style="font-size: 13px; color: #666;">Scanned: ${data.endpoint}</span>
          </div>

          <!-- Summary Stats -->
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
            <div style="text-align: center; padding: 12px; background: rgba(22,163,74,0.1); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: 700; color: #16A34A;">${data.summary?.passed || 0}</div>
              <div style="font-size: 12px; color: #666;">Passed</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(220,38,38,0.1); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: 700; color: #DC2626;">${data.summary?.failed || 0}</div>
              <div style="font-size: 12px; color: #666;">Failed</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(202,138,4,0.1); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: 700; color: #CA8A04;">${data.summary?.warnings || 0}</div>
              <div style="font-size: 12px; color: #666;">Warnings</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(100,116,139,0.1); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: 700; color: #64748B;">${data.summary?.skipped || 0}</div>
              <div style="font-size: 12px; color: #666;">Skipped</div>
            </div>
          </div>

          <!-- Critical Issues -->
          ${data.critical_issues && data.critical_issues.length > 0 ? `
          <div style="margin-bottom: 20px; padding: 16px; background: rgba(220,38,38,0.15); border-radius: 8px; border: 1px solid rgba(220,38,38,0.3);">
            <h4 style="margin-bottom: 12px; color: #DC2626; display: flex; align-items: center; gap: 8px;">
              <span>üö® Critical Issues (${data.critical_issues.length})</span>
            </h4>
            <p style="font-size: 13px; margin-bottom: 12px; color: #7F1D1D;">These issues should be addressed immediately:</p>
            ${renderChecks(data.critical_issues)}
          </div>
          ` : ''}

          <!-- All Checks -->
          <div style="margin-bottom: 16px;">
            <h4 style="margin-bottom: 12px; color: var(--color-dark);">üîç All Security Checks</h4>
            ${renderChecks(data.checks)}
          </div>

          <!-- Recommendations -->
          <div style="padding: 16px; background: linear-gradient(135deg, rgba(46,134,171,0.1), rgba(71,201,122,0.1)); border-radius: 8px;">
            <h4 style="margin-bottom: 12px; color: var(--color-dark);">üí° What This Means</h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 14px; color: var(--color-dark);">
              <li style="margin-bottom: 8px;">UCP exposes your checkout to AI agents - security is critical</li>
              <li style="margin-bottom: 8px;">Implement rate limiting to prevent abuse and DoS attacks</li>
              <li style="margin-bottom: 8px;">HTTPS and security headers protect against common attacks</li>
              <li style="margin-bottom: 8px;">CORS should be configured to allow AI agent access</li>
            </ul>
          </div>
        `;

      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = `<p>‚ùå Security scan failed: ${err.message}</p><p style="font-size: 13px; margin-top: 8px;">Make sure the domain is accessible.</p>`;
      }

      btn.disabled = false;
      btn.textContent = 'üîç Run Security Scan';
    });

    // Feed Analyzer form
    document.getElementById('feed-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('feed-btn');
      const result = document.getElementById('feed-result');
      const url = document.getElementById('feed-url').value.trim();
      const maxProducts = parseInt(document.getElementById('feed-max-products').value);

      btn.disabled = true;
      btn.textContent = 'üîÑ Analyzing Feed...';
      result.className = 'result';
      result.innerHTML = '';

      try {
        const res = await fetch('/api/analyze-feed', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url, maxProducts, includeProductDetails: true })
        });
        const data = await res.json();

        if (data.error) {
          throw new Error(data.message || data.error);
        }

        const score = data.overallScore || 0;
        const visibilityScore = data.agentVisibilityScore || 0;
        const grade = data.grade || 'F';

        // Grade colors
        const gradeColors = {
          'A': { bg: '#dcfce7', border: '#86efac', text: '#16A34A' },
          'B': { bg: '#dbeafe', border: '#93c5fd', text: '#2563EB' },
          'C': { bg: '#fef9c3', border: '#fde047', text: '#CA8A04' },
          'D': { bg: '#fed7aa', border: '#fdba74', text: '#EA580C' },
          'F': { bg: '#fee2e2', border: '#fca5a5', text: '#DC2626' },
        };
        const colors = gradeColors[grade] || gradeColors['F'];

        // Priority colors
        const priorityColors = {
          'high': { bg: 'rgba(220,38,38,0.1)', text: '#DC2626', icon: 'üî¥' },
          'medium': { bg: 'rgba(202,138,4,0.1)', text: '#CA8A04', icon: 'üü°' },
          'low': { bg: 'rgba(37,99,235,0.1)', text: '#2563EB', icon: 'üîµ' },
        };

        result.className = 'result show';
        result.style.background = colors.bg;
        result.style.border = '1px solid ' + colors.border;

        // Calculate percentages for summary
        const total = data.summary?.totalProducts || 0;
        const pct = (val) => total > 0 ? Math.round((val / total) * 100) : 0;

        // Render category score bar
        const renderCategoryBar = (name, score, color) => `
          <div style="margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 2px; font-size: 12px;">
              <span>${name}</span>
              <span style="font-weight: 600;">${score}%</span>
            </div>
            <div style="height: 8px; background: rgba(0,0,0,0.1); border-radius: 4px; overflow: hidden;">
              <div style="height: 100%; width: ${score}%; background: ${color}; border-radius: 4px;"></div>
            </div>
          </div>
        `;

        // Render recommendations
        const renderRecommendations = (recs) => {
          if (!recs || recs.length === 0) return '<p style="color: #666; font-size: 13px;">No recommendations - your feed looks great!</p>';
          return recs.map(r => {
            const pColors = priorityColors[r.priority] || priorityColors['medium'];
            return `
              <div style="padding: 12px 16px; margin: 8px 0; border-radius: 8px; background: ${pColors.bg}; border-left: 4px solid ${pColors.text};">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                  <span>${pColors.icon}</span>
                  <strong style="color: var(--color-dark);">${r.title}</strong>
                  <span style="font-size: 11px; padding: 2px 6px; background: rgba(0,0,0,0.1); border-radius: 4px;">${r.affectedCount} products</span>
                </div>
                <p style="margin: 0 0 0 28px; font-size: 13px; color: var(--color-medium);">${r.description}</p>
                <p style="margin: 4px 0 0 28px; font-size: 12px; color: ${pColors.text};"><strong>Impact:</strong> ${r.impact}</p>
              </div>
            `;
          }).join('');
        };

        result.innerHTML = `
          <!-- Score Header -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
            <div>
              <span class="score-badge ${grade}">${grade} ${score}/100</span>
              <span style="margin-left: 12px; font-weight: 600; color: ${colors.text};">Feed Quality</span>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 13px; color: #666;">Analyzed: ${data.productsAnalyzed}/${data.productsFound} products</div>
            </div>
          </div>

          ${data.warning ? `
          <div style="padding: 12px 16px; margin-bottom: 20px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; font-size: 13px;">
            <strong>‚ö†Ô∏è ${data.warning}:</strong> ${data.message}
          </div>
          ` : ''}

          <!-- AI Visibility Score -->
          <div style="padding: 20px; margin-bottom: 20px; background: linear-gradient(135deg, rgba(46,134,171,0.15), rgba(71,201,122,0.15)); border-radius: 12px; text-align: center;">
            <div style="font-size: 14px; color: #666; margin-bottom: 8px;">AI Agent Visibility Score</div>
            <div style="font-size: 48px; font-weight: 700; color: ${visibilityScore >= 80 ? '#16A34A' : visibilityScore >= 60 ? '#CA8A04' : '#DC2626'};">${visibilityScore}%</div>
            <div style="font-size: 13px; color: #666; margin-top: 8px;">
              ${visibilityScore >= 80 ? '‚úÖ Excellent - AI agents can easily discover and recommend your products' :
                visibilityScore >= 60 ? '‚ö†Ô∏è Fair - Some products may not be visible to AI shopping agents' :
                '‚ùå Low - Many products are invisible to AI shopping agents'}
            </div>
          </div>

          <!-- Summary Stats -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px; margin-bottom: 20px;">
            <div style="text-align: center; padding: 12px; background: rgba(22,163,74,0.1); border-radius: 8px;">
              <div style="font-size: 20px; font-weight: 700; color: #16A34A;">${pct(data.summary?.withName)}%</div>
              <div style="font-size: 11px; color: #666;">Have Names</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(37,99,235,0.1); border-radius: 8px;">
              <div style="font-size: 20px; font-weight: 700; color: #2563EB;">${pct(data.summary?.withPrice)}%</div>
              <div style="font-size: 11px; color: #666;">Have Prices</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(147,51,234,0.1); border-radius: 8px;">
              <div style="font-size: 20px; font-weight: 700; color: #9333EA;">${pct(data.summary?.withImages)}%</div>
              <div style="font-size: 11px; color: #666;">Have Images</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(234,88,12,0.1); border-radius: 8px;">
              <div style="font-size: 20px; font-weight: 700; color: #EA580C;">${pct(data.summary?.withGtin)}%</div>
              <div style="font-size: 11px; color: #666;">Have GTIN</div>
            </div>
            <div style="text-align: center; padding: 12px; background: rgba(20,184,166,0.1); border-radius: 8px;">
              <div style="font-size: 20px; font-weight: 700; color: #14B8A6;">${pct(data.summary?.withDescription)}%</div>
              <div style="font-size: 11px; color: #666;">Have Desc</div>
            </div>
          </div>

          <!-- Category Scores -->
          <div style="margin-bottom: 20px; padding: 16px; background: rgba(255,255,255,0.5); border-radius: 8px;">
            <h4 style="margin-bottom: 12px; color: var(--color-dark);">üìä Category Breakdown</h4>
            ${renderCategoryBar('Completeness', data.categoryScores?.completeness || 0, '#2E86AB')}
            ${renderCategoryBar('Pricing', data.categoryScores?.pricing || 0, '#16A34A')}
            ${renderCategoryBar('Images', data.categoryScores?.images || 0, '#9333EA')}
            ${renderCategoryBar('Identifiers (SKU/GTIN)', data.categoryScores?.identifiers || 0, '#EA580C')}
            ${renderCategoryBar('Descriptions', data.categoryScores?.descriptions || 0, '#14B8A6')}
            ${renderCategoryBar('Availability', data.categoryScores?.availability || 0, '#64748B')}
          </div>

          <!-- Recommendations -->
          <div style="margin-bottom: 16px;">
            <h4 style="margin-bottom: 12px; color: var(--color-dark);">üí° Recommendations</h4>
            ${renderRecommendations(data.recommendations)}
          </div>

          <!-- Info Box -->
          <div style="padding: 16px; background: linear-gradient(135deg, rgba(46,134,171,0.1), rgba(71,201,122,0.1)); border-radius: 8px;">
            <h4 style="margin-bottom: 12px; color: var(--color-dark);">ü§ñ Why This Matters</h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 14px; color: var(--color-dark);">
              <li style="margin-bottom: 8px;">AI shopping agents use Schema.org Product data to understand your catalog</li>
              <li style="margin-bottom: 8px;">Missing prices mean AI agents can't complete purchases</li>
              <li style="margin-bottom: 8px;">GTINs enable cross-platform product matching for better visibility</li>
              <li style="margin-bottom: 8px;">Rich descriptions help AI agents recommend the right products</li>
            </ul>
          </div>
        `;

      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = `<p>‚ùå Feed analysis failed: ${err.message}</p><p style="font-size: 13px; margin-top: 8px;">Make sure the URL is accessible and contains Schema.org Product markup.</p>`;
      }

      btn.disabled = false;
      btn.textContent = 'üîç Analyze Product Feed';
    });

    // Lawful basis description updates
    const basisDescriptions = {
      'contract': 'Processing is necessary to fulfill customer orders',
      'consent': 'Customer explicitly consents to data processing',
      'legitimate': 'Processing serves legitimate business interests',
      'legal': 'Processing is required by law',
    };
    document.getElementById('compliance-basis').addEventListener('change', (e) => {
      document.getElementById('basis-description').textContent = basisDescriptions[e.target.value] || '';
    });

    // Compliance Generator form
    document.getElementById('compliance-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('compliance-btn');
      const result = document.getElementById('compliance-result');

      // Gather form data
      const companyName = document.getElementById('compliance-company').value.trim();
      const companyEmail = document.getElementById('compliance-email').value.trim();
      const dpoEmail = document.getElementById('compliance-dpo').value.trim();
      const lawfulBasis = document.getElementById('compliance-basis').value;

      // Gather regions
      const regions = [];
      if (document.getElementById('region-eu').checked) regions.push('eu');
      if (document.getElementById('region-uk').checked) regions.push('uk');
      if (document.getElementById('region-california').checked) regions.push('california');
      if (document.getElementById('region-global').checked) regions.push('global');

      // Gather platforms
      const platforms = [];
      if (document.getElementById('platform-openai').checked) platforms.push('openai');
      if (document.getElementById('platform-google').checked) platforms.push('google');
      if (document.getElementById('platform-microsoft').checked) platforms.push('microsoft');

      // Options
      const includeMarketingConsent = document.getElementById('include-marketing').checked;
      const includeDataRetention = document.getElementById('include-retention').checked;

      // Validate
      if (!companyName) {
        result.className = 'result show error';
        result.innerHTML = '<p>Please enter your company name</p>';
        return;
      }
      if (regions.length === 0) {
        result.className = 'result show error';
        result.innerHTML = '<p>Please select at least one compliance region</p>';
        return;
      }
      if (platforms.length === 0) {
        result.className = 'result show error';
        result.innerHTML = '<p>Please select at least one AI platform</p>';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'üîÑ Generating...';
      result.className = 'result';
      result.innerHTML = '';

      try {
        const res = await fetch('/api/generate-compliance', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            companyName,
            companyEmail: companyEmail || undefined,
            dpoEmail: dpoEmail || undefined,
            regions,
            platforms,
            lawfulBasis,
            includeMarketingConsent,
            includeDataRetention,
            retentionPeriodYears: 7,
          })
        });
        const data = await res.json();

        if (data.error) {
          throw new Error(data.message || data.error);
        }

        // Store for download
        window.complianceData = data;

        result.className = 'result show success';
        result.innerHTML = `
          <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 12px; color: var(--brand-teal);">‚úÖ Compliance Documents Generated</h4>
            <p style="font-size: 13px; color: var(--color-medium);">
              Generated for: ${companyName} | Regions: ${regions.join(', ').toUpperCase()} | Basis: ${lawfulBasis}
            </p>
          </div>

          <!-- Download Buttons -->
          <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 24px;">
            <button class="btn" onclick="downloadComplianceHtml()">üì• Download HTML</button>
            <button class="btn btn-secondary" onclick="downloadComplianceTxt()">üìÑ Download Text</button>
            <button class="btn btn-secondary" onclick="copyComplianceSnippet('aiCommerceSection')">üìã Copy AI Commerce Section</button>
          </div>

          <!-- Preview Sections -->
          <div style="background: var(--color-background); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
            <h5 style="margin-bottom: 12px; cursor: pointer;" onclick="toggleSection('preview-privacy')">
              üìÑ Privacy Policy Addendum <span style="color: var(--color-light);">‚ñº</span>
            </h5>
            <div id="preview-privacy" style="display: none;">
              <pre style="font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; background: white; padding: 12px; border-radius: 4px;">${escapeHtml(data.snippets.aiCommerceSection)}</pre>
              <button class="btn btn-secondary" style="margin-top: 8px;" onclick="copyComplianceSnippet('aiCommerceSection')">Copy</button>
            </div>
          </div>

          <div style="background: var(--color-background); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
            <h5 style="margin-bottom: 12px; cursor: pointer;" onclick="toggleSection('preview-processors')">
              üîó Data Processor Disclosures <span style="color: var(--color-light);">‚ñº</span>
            </h5>
            <div id="preview-processors" style="display: none;">
              <pre style="font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; background: white; padding: 12px; border-radius: 4px;">${escapeHtml(data.snippets.processorDisclosures)}</pre>
              <button class="btn btn-secondary" style="margin-top: 8px;" onclick="copyComplianceSnippet('processorDisclosures')">Copy</button>
            </div>
          </div>

          <div style="background: var(--color-background); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
            <h5 style="margin-bottom: 12px; cursor: pointer;" onclick="toggleSection('preview-consent')">
              ‚úçÔ∏è Consent Language <span style="color: var(--color-light);">‚ñº</span>
            </h5>
            <div id="preview-consent" style="display: none;">
              <pre style="font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; background: white; padding: 12px; border-radius: 4px;">${escapeHtml(data.snippets.consentLanguage)}</pre>
              <button class="btn btn-secondary" style="margin-top: 8px;" onclick="copyComplianceSnippet('consentLanguage')">Copy</button>
            </div>
          </div>

          <div style="background: var(--color-background); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
            <h5 style="margin-bottom: 12px; cursor: pointer;" onclick="toggleSection('preview-rights')">
              ‚öñÔ∏è Data Subject Rights <span style="color: var(--color-light);">‚ñº</span>
            </h5>
            <div id="preview-rights" style="display: none;">
              <pre style="font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; background: white; padding: 12px; border-radius: 4px;">${escapeHtml(data.snippets.dataSubjectRights)}</pre>
              <button class="btn btn-secondary" style="margin-top: 8px;" onclick="copyComplianceSnippet('dataSubjectRights')">Copy</button>
            </div>
          </div>

          <!-- Disclaimer -->
          <div style="margin-top: 20px; padding: 16px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px;">
            <h5 style="margin-bottom: 8px;">‚ö†Ô∏è Important</h5>
            <ul style="margin: 0; padding-left: 20px; font-size: 13px;">
              <li>This is a template - have it reviewed by a legal professional</li>
              <li>Privacy laws vary by jurisdiction and change frequently</li>
              <li>Your specific circumstances may require additional provisions</li>
            </ul>
          </div>
        `;

      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = '<p>‚ùå Generation failed: ' + err.message + '</p>';
      }

      btn.disabled = false;
      btn.textContent = 'üìÑ Generate Compliance Documents';
    });

    // Toggle preview sections
    function toggleSection(id) {
      const el = document.getElementById(id);
      if (el) {
        el.style.display = el.style.display === 'none' ? 'block' : 'none';
      }
    }

    // Download compliance HTML
    function downloadComplianceHtml() {
      if (!window.complianceData) return;
      const blob = new Blob([window.complianceData.embedHtml], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ai-commerce-privacy-addendum.html';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Download compliance text
    function downloadComplianceTxt() {
      if (!window.complianceData) return;
      const blob = new Blob([window.complianceData.plainText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ai-commerce-privacy-addendum.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Copy compliance snippet
    function copyComplianceSnippet(key) {
      if (!window.complianceData || !window.complianceData.snippets[key]) return;
      navigator.clipboard.writeText(window.complianceData.snippets[key]).then(() => {
        alert('Copied to clipboard!');
      });
    }
  </script>
</body>

</html>